<!doctype html>
<html lang="zh"><head>
<title>NVIDIA BlueField-2 DPU 配置为 NIC 网卡的折腾过程 - Recopec 的博客</title>
<meta charset="UTF-8">
<meta name="keywords" content="">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">

<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta name="description" content="前情提要 朋友搞来一块 NVIDIA BlueField-2 给我来玩玩，据说是他进 DPU 里面的 ARM 系统里面执行了一下更新命令，然后电脑设备管理器就感叹号了，里面的 ARM 跑着的系统也挂了。具体的情况他也不清楚，反正就到我手上了。 让他发了一块好的和一块坏的，两张都收到了，还带了一个 VMWare的 Edge 310 给我来研究。  实物情况 第一块 图片是后补的，不要介意。   背面">
<meta property="og:type" content="article">
<meta property="og:title" content="NVIDIA BlueField-2 DPU 配置为 NIC 网卡的折腾过程">
<meta property="og:url" content="https://blog.irec.moe/nvidia_boyfriend.html">
<meta property="og:site_name" content="Recopec 的博客">
<meta property="og:description" content="前情提要 朋友搞来一块 NVIDIA BlueField-2 给我来玩玩，据说是他进 DPU 里面的 ARM 系统里面执行了一下更新命令，然后电脑设备管理器就感叹号了，里面的 ARM 跑着的系统也挂了。具体的情况他也不清楚，反正就到我手上了。 让他发了一块好的和一块坏的，两张都收到了，还带了一个 VMWare的 Edge 310 给我来研究。  实物情况 第一块 图片是后补的，不要介意。   背面">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.irec.moe/nvidia_boyfriend/DSC1087.jpg">
<meta property="og:image" content="https://blog.irec.moe/nvidia_boyfriend/DSC1091.jpg">
<meta property="og:image" content="https://blog.irec.moe/nvidia_boyfriend/DSC1094.jpg">
<meta property="og:image" content="https://blog.irec.moe/nvidia_boyfriend/image-20240715233118990.png">
<meta property="og:image" content="https://blog.irec.moe/nvidia_boyfriend/image-20240715211452502.png">
<meta property="og:image" content="https://blog.irec.moe/nvidia_boyfriend/image-20240715210804919.png">
<meta property="og:image" content="https://blog.irec.moe/nvidia_boyfriend/image-20240715210920040.png">
<meta property="og:image" content="https://blog.irec.moe/nvidia_boyfriend/image-20240715211052801.png">
<meta property="og:image" content="https://blog.irec.moe/nvidia_boyfriend/image-20240715213306232.png">
<meta property="article:published_time" content="2024-07-16T04:00:00.000Z">
<meta property="article:modified_time" content="2024-08-15T06:20:07.360Z">
<meta property="article:author" content="Recopec">
<meta property="article:tag" content="网卡">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.irec.moe/nvidia_boyfriend/DSC1087.jpg">

<link rel="stylesheet" href="/lib/fancybox/fancybox.css">
<link rel="stylesheet" href="/lib/mdui_043tiny/mdui.css">


<link rel="stylesheet" href="/lib/iconfont/iconfont.css?v=1751910940683">

<link rel="stylesheet" href="/css/style.css?v=1751910940683">






<script src="/lib/mdui_043tiny/mdui.js" async></script>
<script src="/lib/fancybox/fancybox.umd.js" async></script>
<script src="/lib/lax.min.js" async></script>


<script async src="/js/app.js?v=1751910940683"></script>

 



<link rel="stylesheet"  href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css">
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-shiki-plugin@latest/lib/codeblock.css">
<style>:root{--hl-color:#abb2bf;--hl-bg:#282c34;--hltools-bg:#21252b;--hltools-color:#bbbbbc;--hlnumber-bg:#282c34;--hlnumber-color:#495162;--hlscrollbar-bg:#373c47;--hlexpand-bg:linear-gradient(180deg,rgba(40,44,52,0.1),rgba(40,44,52,0.9))}</style><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Recopec 的博客" type="application/atom+xml">
</head><body class="nexmoe mdui-drawer-body-left"><div id="nexmoe-background"><div class="nexmoe-bg" style="background-image: url(https://cdn.jsdelivr.net/gh/Recopec/Recopec.github.io@latest/images/bg.jpg)"></div><div class="mdui-appbar mdui-shadow-0"><div class="mdui-toolbar"><a class="mdui-btn mdui-btn-icon mdui-ripple" mdui-drawer="{target: &#039;#drawer&#039;, swipe: true}" title="menu"><i class="mdui-icon nexmoefont icon-menu"></i></a><div class="mdui-toolbar-spacer"></div><a class="mdui-btn mdui-btn-icon" href="/" title="Recopec"><img src="https://cdn.jsdelivr.net/gh/Recopec/Recopec.github.io@latest/images/avatar.jpg" alt="Recopec"></a></div></div></div><div id="nexmoe-header"><div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="Recopec">
            <img src="https://cdn.jsdelivr.net/gh/Recopec/Recopec.github.io@latest/images/avatar.jpg" alt="Recopec" alt="Recopec">
        </a>
    </div>
    <div class="nexmoe-count">
        <div><span>文章</span>20</div>
        <div><span>标签</span>27</div>
        <div><span>分类</span>6</div>
    </div>
    <div class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/" title="回到首页">
            <i class="mdui-list-item-icon nexmoefont icon-home"></i>
            <div class="mdui-list-item-content">
                回到首页
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/archive.html" title="文章归档">
            <i class="mdui-list-item-icon nexmoefont icon-container"></i>
            <div class="mdui-list-item-content">
                文章归档
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/PY.html" title="我的朋友">
            <i class="mdui-list-item-icon nexmoefont icon-unorderedlist"></i>
            <div class="mdui-list-item-content">
                我的朋友
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/about.html" title="关于博主">
            <i class="mdui-list-item-icon nexmoefont icon-info-circle"></i>
            <div class="mdui-list-item-content">
                关于博主
            </div>
        </a>
        
    </div>
    
    
        
        <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-search">
         
            <form id="search_form" action_e="https://cn.bing.com/search?q=site:irec.moe" onsubmit="return search();">
                <label><input id="search_value" name="q" type="search" placeholder="搜索"></label>
            </form>
         
    </div>
</div>




    
        
        <div class="nexmoe-widget-wrap">
	<div class="nexmoe-widget nexmoe-social">
		<a
			class="mdui-ripple"
			href="https://space.bilibili.com/8209358"
			target="_blank"
			mdui-tooltip="{content: '哔哩哔哩'}"
			style="
				color: rgb(231, 106, 141);
				background-color: rgba(231, 106, 141, .1);
			"
		>
			<i
				class="nexmoefont icon-bilibili"
			></i> </a
		><a
			class="mdui-ripple"
			href="https://github.com/Recopec/"
			target="_blank"
			mdui-tooltip="{content: 'GitHub'}"
			style="
				color: rgb(25, 23, 23);
				background-color: rgba(25, 23, 23, .1);
			"
		>
			<i
				class="nexmoefont icon-github"
			></i> </a
		><a
			class="mdui-ripple"
			href="https://twitter.com/Recopec"
			target="_blank"
			mdui-tooltip="{content: 'Twitter'}"
			style="
				color: rgb(59, 151, 239);
				background-color: rgba(59, 151, 239, .1);
			"
		>
			<i
				class="nexmoefont icon-twitter"
			></i> </a
		><a
			class="mdui-ripple"
			href="https://t.me/Recopec"
			target="_blank"
			mdui-tooltip="{content: 'TG'}"
			style="
				color: rgb(70, 151, 239);
				background-color: rgba(59, 151, 239, .1);
			"
		>
			<i
				class="nexmoefont icon-telegram"
			></i> </a
		>
	</div>
</div>

    
        
        
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">文章分类</h3>
    <div class="nexmoe-widget">

      <ul class="category-list">

        


        

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/THM/">THM</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/学习/">学习</a>
          <span class="category-list-count">3</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/无线电/">无线电</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/生活/">生活</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/硬件/">硬件</a>
          <span class="category-list-count">8</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/网络/">网络</a>
          <span class="category-list-count">3</span>
        </li>

        
      </ul>

    </div>
  </div>


    
        
        
  <div class="nexmoe-widget-wrap">
    <div id="randomtagcloud" class="nexmoe-widget tagcloud nexmoe-rainbow">
      <a href="/tags/OpenClash/" style="font-size: 10px;">OpenClash</a> <a href="/tags/OpenWrt/" style="font-size: 10px;">OpenWrt</a> <a href="/tags/PC/" style="font-size: 10px;">PC</a> <a href="/tags/VR/" style="font-size: 10px;">VR</a> <a href="/tags/Windows/" style="font-size: 10px;">Windows</a> <a href="/tags/WireGuard/" style="font-size: 10px;">WireGuard</a> <a href="/tags/WireShark/" style="font-size: 10px;">WireShark</a> <a href="/tags/%E4%BF%9D%E5%81%A5/" style="font-size: 10px;">保健</a> <a href="/tags/%E5%85%89%E7%8C%AB/" style="font-size: 20px;">光猫</a> <a href="/tags/%E5%8D%87%E5%AD%A6/" style="font-size: 10px;">升学</a> <a href="/tags/%E5%8D%AB%E6%98%9F/" style="font-size: 10px;">卫星</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 20px;">数据库</a> <a href="/tags/%E6%97%A0%E7%BA%BF%E7%94%B5/" style="font-size: 10px;">无线电</a> <a href="/tags/%E6%A0%88/" style="font-size: 10px;">栈</a> <a href="/tags/%E6%AF%94%E8%B5%9B/" style="font-size: 10px;">比赛</a> <a href="/tags/%E7%81%B5%E8%BD%A6/" style="font-size: 10px;">灵车</a> <a href="/tags/%E7%94%B5%E6%B1%A0/" style="font-size: 10px;">电池</a> <a href="/tags/%E7%9F%AD%E6%B3%A2/" style="font-size: 10px;">短波</a> <a href="/tags/%E7%A1%AC%E7%9B%98/" style="font-size: 10px;">硬盘</a> <a href="/tags/%E7%AC%94%E8%AE%B0/" style="font-size: 20px;">笔记</a> <a href="/tags/%E7%BB%8F%E9%AA%8C/" style="font-size: 10px;">经验</a> <a href="/tags/%E7%BB%AD%E5%91%BD/" style="font-size: 10px;">续命</a> <a href="/tags/%E7%BD%91%E5%8D%A1/" style="font-size: 10px;">网卡</a> <a href="/tags/%E7%BE%8A%E6%AF%9B/" style="font-size: 10px;">羊毛</a> <a href="/tags/%E7%BE%A4%E6%99%96/" style="font-size: 20px;">群晖</a> <a href="/tags/%E8%80%83%E8%AF%95/" style="font-size: 10px;">考试</a> <a href="/tags/%E9%93%B6%E8%A1%8C%E5%8D%A1/" style="font-size: 10px;">银行卡</a>
    </div>
    
      <script>
        var maxTagcloud = parseInt(17);
        var tags_length = parseInt(27);
        var tags_arr = [];
        for(var i = 0; i < tags_length; i++){
          tags_arr.push(i);
        }
        tags_arr.sort(function (l, r) {
          return Math.random() > 0.5 ? -1 : 1;
        });
        tags_arr = tags_arr.slice(0, maxTagcloud < tags_length ? tags_length - maxTagcloud : 0);
        for(var tag_i = 0; tag_i < tags_arr.length; tag_i++){
          document.getElementById("randomtagcloud").children[tags_arr[tag_i]].style.display = 'none';
        }
      </script>
    
  </div>

    
        
        <!-- 一言 -->
<div class="nexmoe-widget-wrap">
  <h3 class="nexmoe-widget-title">
    一言
  </h3>
  <div class="nexmoe-widget">
    <ul class="hitokoto-box">
      <li id="hitokoto_text_parent" class="hitokoto-text" hitokotoCategory="">
        <a href="#" id="hitokoto_text">
          
        </a>
        <a href="#" id="hitokoto_error_text" style="display: none;">
          
        </a>
      </li>
    </ul>
  </div>
</div>

<script>
  let hitokotoText = document.getElementById('hitokoto_text')
  let hitokotoErroText = document.getElementById('hitokoto_error_text')
  let hitokotoCategory = document.getElementById('hitokoto_text_parent').getAttribute('hitokotoCategory')
  window.addEventListener('load', function () {
    let url = 'https://v1.hitokoto.cn'
    if (hitokotoCategory) {
      url += '?c=' + hitokotoCategory
    }
    fetch(url)
      .then(response => response.json())
      .then(data => {
        hitokotoText.innerText = "「 " + data.hitokoto + " 」 from " + data.from
        hitokotoText.href = 'https://hitokoto.cn/?uuid=' + data.uuid
      })
      .catch((reason) => {
        console.error(11, reason)
        hitokotoText.style.display = 'none'
        hitokotoErroText.style.display = 'block'
      })
  })
</script>
    
        
        
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">文章归档</h3>
    <div class="nexmoe-widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/">2025</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/">2024</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/">2023</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/">2022</a><span class="archive-list-count">3</span></li></ul>
    </div>
  </div>



    
        
        
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">最新文章</h3>
    <div class="nexmoe-widget">
      <ul>
        
          <li>
            <a href="/thm_bufferoverflow.html">Try Hack Me - Buffer Overflow Prep</a>
          </li>
        
          <li>
            <a href="/thm_steelmountain.html">Try Hack Me - Steel Mountain</a>
          </li>
        
          <li>
            <a href="/ssd_boom_dsm.html">灵车固态炸了整台群晖</a>
          </li>
        
          <li>
            <a href="/cqwwssb2024.html">BH7FBP 2024 CQWW SSB SOSB LP 10m 比赛记录</a>
          </li>
        
          <li>
            <a href="/qsoviasat.html">如何正确的优雅的完成 FM 卫星通联</a>
          </li>
        
      </ul>
    </div>
  </div>

    
        
   
    <div class="nexmoe-copyright">
        &copy; 2025 Recopec
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://github.com/theme-nexmoe/hexo-theme-nexmoe" target="_blank">Nexmoe</a>
        
    </div>
</div><!-- .nexmoe-drawer --></div><div id="nexmoe-content"><div class="nexmoe-primary"><div class="nexmoe-post">
  <article>
    
        <div class="nexmoe-post-cover absolute" style="padding-top: 43.75%;"> 
            <img src="/nvidia_boyfriend/cover.jpg" alt="NVIDIA BlueField-2 DPU 配置为 NIC 网卡的折腾过程" loading="lazy">
            <h1>NVIDIA BlueField-2 DPU 配置为 NIC 网卡的折腾过程</h1>
        </div>
    
    
    <div class="nexmoe-post-meta">
    <div class="nexmoe-rainbow">
        <a class="nexmoefont icon-calendar-fill">2024年07月16日</a>
        
            <a class="nexmoefont icon-appstore-fill -link" href="/categories/%E7%A1%AC%E4%BB%B6/">硬件</a>
        
        
    <a><i class="nexmoefont icon-areachart"></i>约2.7k字</a>
    <a><i class="nexmoefont icon-time-circle-fill"></i>预计需要14分钟</a>

    </div>
    
    
    
    
    
</div>

    <h1>前情提要</h1>
<p>朋友搞来一块 NVIDIA BlueField-2 给我来玩玩，据说是他进 DPU 里面的 ARM 系统里面执行了一下更新命令，然后电脑设备管理器就感叹号了，里面的 ARM 跑着的系统也挂了。具体的情况他也不清楚，反正就到我手上了。</p>
<p>让他发了一块好的和一块坏的，两张都收到了，还带了一个 VMWare的 Edge 310 给我来研究。</p>
<img src="/nvidia_boyfriend/DSC1087.jpg" class="" title="DSC1087">
<h1>实物情况</h1>
<h2 id="第一块">第一块</h2>
<p>图片是后补的，不要介意。</p>
<img src="/nvidia_boyfriend/DSC1091.jpg" class="" title="DSC1091">
<img src="/nvidia_boyfriend/DSC1094.jpg" class="" title="DSC1094">
<h3 id="背面标签">背面标签</h3>
<p>Model No：BF2M345A</p>
<p>P/N: MBF2M345A-VENOT_ES</p>
<p>S/N: MT219X37294</p>
<p>开机非常慢，设备管理器有一个模块报错误10</p>
<img src="/nvidia_boyfriend/image-20240715233118990.png" class="" title="image-20240715233118990">
<p>使用和主机通讯的串口，不知道账户和密码，只能重置了。</p>
<h3 id="启动信息">启动信息</h3>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">Mellanox BlueField-2 A1 BL1 V1.1</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL2R: v2.2(release):3.7.1-1-g7a249ba</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL2R: Built : 18:59:31, Jul 22 2021</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL2R built for hw (ver 1)</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  No CDI given, can&#39;t complete Riot operation</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL2R: Booting BL2</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL2: v2.2(release):3.7.1-1-g7a249ba</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL2: Built : 18:59:30, Jul 22 2021</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL2 built for hw (ver 1)</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  Running as MBF2M345A-VENOT_ system</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  No SPD detected on MSS0 DIMM0</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  No SPD detected on MSS0 DIMM1</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  Finished initializing DDR</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  DDR POST passed.</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL31: v2.2(release):3.7.1-1-g7a249ba</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL31: Built : 18:59:31, Jul 22 2021</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL31 built for hw (ver 1)</span></span></code></pre></div></div></figure>
<h3 id="固件版本">固件版本</h3>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">C:\Program Files\Mellanox\WinMFT&gt;mlxfwmanager.exe</span></span>
<span class="line"><span style="color: #abb2bf">Querying Mellanox devices firmware ...</span></span>
<span class="line"><span style="color: #abb2bf"></span></span>
<span class="line"><span style="color: #abb2bf">Device #1:</span></span>
<span class="line"><span style="color: #abb2bf">----------</span></span>
<span class="line"><span style="color: #abb2bf"></span></span>
<span class="line"><span style="color: #abb2bf">  Device Type:      BlueField2</span></span>
<span class="line"><span style="color: #abb2bf">  Part Number:      MBF2M345A-VENOT_ES_Ax</span></span>
<span class="line"><span style="color: #abb2bf">  Description:      NVIDIA BlueField-2 E-Series Eng. sample DPU; 200GbE single-port QSFP56; PCIe Gen4 x16; Secure Boot Disabled; Crypto Enabled; 16GB on-board DDR; 1GbE OOB management</span></span>
<span class="line"><span style="color: #abb2bf">  PSID:             MT_0000000809</span></span>
<span class="line"><span style="color: #abb2bf">  PCI Device Name:  mt41686_pciconf0</span></span>
<span class="line"><span style="color: #abb2bf">  Base GUID:        b8cef60300f8d88a</span></span>
<span class="line"><span style="color: #abb2bf">  Base MAC:         b8cef6f8d88a</span></span>
<span class="line"><span style="color: #abb2bf">  Versions:         Current        Available</span></span>
<span class="line"><span style="color: #abb2bf">     FW             24.31.0356     N/A</span></span>
<span class="line"><span style="color: #abb2bf">     PXE            3.6.0401       N/A</span></span>
<span class="line"><span style="color: #abb2bf">     UEFI           14.24.0013     N/A</span></span>
<span class="line"><span style="color: #abb2bf">     UEFI Virtio blk   22.1.0011      N/A</span></span>
<span class="line"><span style="color: #abb2bf">     UEFI Virtio net   21.1.0011      N/A</span></span>
<span class="line"><span style="color: #abb2bf"></span></span>
<span class="line"><span style="color: #abb2bf">  Status:           No matching image found</span></span></code></pre></div></div></figure>
<h2 id="第二块">第二块</h2>
<h3 id="启动信息-2">启动信息</h3>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">Mellanox BlueField-2 A1 BL1 V1.1</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL2R: v2.2(release):3.7.1-1-g7a249ba</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL2R: Built : 18:59:31, Jul 22 2021</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL2R built for hw (ver 1)</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  No CDI given, can&#39;t complete Riot operation</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL2R: Booting BL2</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL2: v2.2(release):3.7.1-1-g7a249ba</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL2: Built : 18:59:30, Jul 22 2021</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL2 built for hw (ver 1)</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  Running as MBF2M345A-VENOT_ system</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  No SPD detected on MSS0 DIMM0</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  No SPD detected on MSS0 DIMM1</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  Finished initializing DDR</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  DDR POST passed.</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL31: v2.2(release):3.7.1-1-g7a249ba</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL31: Built : 18:59:31, Jul 22 2021</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL31 built for hw (ver 1)</span></span></code></pre></div></div></figure>
<h3 id="固件版本-2">固件版本</h3>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">Device #1:</span></span>
<span class="line"><span style="color: #abb2bf">----------</span></span>
<span class="line"><span style="color: #abb2bf"></span></span>
<span class="line"><span style="color: #abb2bf">  Device Type:      BlueField2</span></span>
<span class="line"><span style="color: #abb2bf">  Part Number:      MBF2M345A-VENOT_ES_Ax</span></span>
<span class="line"><span style="color: #abb2bf">  Description:      NVIDIA BlueField-2 E-Series Eng. sample DPU; 200GbE single-port QSFP56; PCIe Gen4 x16; Secure Boot Disabled; Crypto Enabled; 16GB on-board DDR; 1GbE OOB management</span></span>
<span class="line"><span style="color: #abb2bf">  PSID:             MT_0000000809</span></span>
<span class="line"><span style="color: #abb2bf">  PCI Device Name:  mt41686_pciconf0</span></span>
<span class="line"><span style="color: #abb2bf">  Base GUID:        b8cef60300fc5446</span></span>
<span class="line"><span style="color: #abb2bf">  Base MAC:         b8cef6fc5446</span></span>
<span class="line"><span style="color: #abb2bf">  Versions:         Current        Available</span></span>
<span class="line"><span style="color: #abb2bf">     FW             24.31.0356     N/A</span></span>
<span class="line"><span style="color: #abb2bf">     PXE            3.6.0401       N/A</span></span>
<span class="line"><span style="color: #abb2bf">     UEFI           14.24.0013     N/A</span></span>
<span class="line"><span style="color: #abb2bf">     UEFI Virtio blk   22.1.0011      N/A</span></span>
<span class="line"><span style="color: #abb2bf">     UEFI Virtio net   21.1.0011      N/A</span></span>
<span class="line"><span style="color: #abb2bf"></span></span>
<span class="line"><span style="color: #abb2bf">  Status:           No matching image found</span></span></code></pre></div></div></figure>
<h1>资源</h1>
<p>所有的资源都是来自 NVIDIA 官网</p>
<h2 id="文档">文档</h2>
<h3 id="DOCA-文档">DOCA 文档</h3>
<p><a target="_blank" rel="noopener" href="https://docs.nvidia.com/networking/dpu-doca/index.html#doca">https://docs.nvidia.com/networking/dpu-doca/index.html#doca</a></p>
<h3 id="1-5-1-LTS-文档">1.5.1 LTS 文档</h3>
<p><a target="_blank" rel="noopener" href="https://docs.nvidia.com/doca/archive/doca-v1.5.1/index.html">https://docs.nvidia.com/doca/archive/doca-v1.5.1/index.html</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.nvidia.com/doca/archive/doca-v1.5.1/installation-guide-for-linux/index.html#abstract">NVIDIA DOCA Installation Guide for Linux</a></p>
<h2 id="DOCA">DOCA</h2>
<p><a target="_blank" rel="noopener" href="https://developer.nvidia.com/doca-downloads">https://developer.nvidia.com/doca-downloads</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.nvidia.com/doca-archive">这里</a> 下载 DOCA 历史版本</p>
<h2 id="网卡固件">网卡固件</h2>
<p><a target="_blank" rel="noopener" href="https://linux.mellanox.com/public/repo/">https://linux.mellanox.com/public/repo/</a></p>
<h1>具体步骤</h1>
<p>物主要求把卡弄好，当成正常的 CX6 网卡使用，参考了下面两个教程和官网的文档。</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Cm421s7sq">https://www.bilibili.com/video/BV1Cm421s7sq</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/read/cv32771337">https://www.bilibili.com/read/cv32771337</a></p>
<h2 id="1、安装-Ubuntu">1、安装 Ubuntu</h2>
<p>这个就不用说了吧。</p>
<h2 id="2、安装-DOCA-环境">2、安装 DOCA 环境</h2>
<p>直接装最新版的就行，不需要特意装1.5.1版本的。</p>
<figure class="shiki sh"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">wget</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">https://www.mellanox.com/downloads/DOCA/DOCA_v2.7.0/host/doca-host_2.7.0-209000-24.04-ubuntu2204_amd64.deb</span></span>
<span class="line"><span style="color: #61AFEF">sudo</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">dpkg</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">-i</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">doca-host_2.7.0-209000-24.04-ubuntu2204_amd64.deb</span></span>
<span class="line"><span style="color: #61AFEF">sudo</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">apt-get</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">update</span></span>
<span class="line"><span style="color: #61AFEF">sudo</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">apt-get</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">-y</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">install</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">doca-all</span></span></code></pre></div></div></figure>
<p>如果碰到卡在 building initial module ，请关闭主板的 Secure Boot 功能。</p>
<h2 id="3、启动-rshim">3、启动 rshim</h2>
<figure class="shiki sh"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">sudo</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">systemctl</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">start</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">rshim</span></span></code></pre></div></div></figure>
<h2 id="4、使用-minicom-连接-DPU">4、使用 minicom 连接 DPU</h2>
<p>如果没装过的话记得 sudo apt get install minicom 一下。</p>
<figure class="shiki sh"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">sudo</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">minicom</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">-D</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">/dev/rshim0/console</span></span></code></pre></div></div></figure>
<h2 id="5、重置-DPU-的-ARM-核">5、重置 DPU 的 ARM 核</h2>
<figure class="shiki sh"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">sudo</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">echo</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;SW_RESET 1&quot;</span><span style="color: #ABB2BF"> &gt; </span><span style="color: #98C379">/dev/rshim0/misc</span></span></code></pre></div></div></figure>
<h2 id="6、向-DPU-更新-DOCA-1-5-1-LTS-版本">6、向 DPU 更新 DOCA 1.5.1-LTS 版本</h2>
<p>首先必须得更新到这个版本，再更新网卡驱动，直接更新最新的 DOCA 版本的话系统会起不来，如图所示。</p>

<figure class="shiki sh"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">bfb-install</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">--rshim</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">rshim0</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">--bfb</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">DOCA_1.5.1_BSP_3.9.3_Ubuntu_20.04-4.2211-LTS.signed.bfb</span></span></code></pre></div></div></figure>
<h2 id="7、启动成功，修改默认账户和密码">7、启动成功，修改默认账户和密码</h2>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">Mellanox BlueField-2 A1 BL1 V1.1</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  No CDI passed to Riot core!</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL2R: v2.2(release):3.9.3-4-g43fe858</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL2R: Built : 19:38:23, Oct 21 2022</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL2R built for hw (ver 1)</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL2R: Booting BL2</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL2: v2.2(release):3.9.3-4-g43fe858</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL2: Built : 19:38:22, Oct 21 2022</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL2 built for hw (ver 1)</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  Running as MBF2M345A-VENOT_ system</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  No SPD detected on MSS0 DIMM0</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  No SPD detected on MSS0 DIMM1</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  Finished initializing DDR</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  DDR POST passed.</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL31: v2.2(release):3.9.3-4-g43fe858</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL31: Built : 19:38:22, Oct 21 2022</span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL31 built for hw (ver 1)</span></span>
<span class="line"><span style="color: #abb2bf">UEFI firmware (version BlueField:3.9.3-7-g8f2d8ca built at 19:40:49 on Oct 21 2022)</span></span></code></pre></div></div></figure>
<p>ubuntu ubuntu</p>
<p>ubuntu Bf112233</p>
<h2 id="8、备份网卡固件">8、备份网卡固件</h2>
<p>在宿主机上执行</p>
<figure class="shiki sh"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">sudo</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">mst</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">status</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">MST</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">modules:</span></span>
<span class="line"><span style="color: #61AFEF">------------</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">MST</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">PCI</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">module</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">is</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">not</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">loaded</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">MST</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">PCI</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">configuration</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">module</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">loaded</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">MST</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">devices:</span></span>
<span class="line"><span style="color: #61AFEF">------------</span></span>
<span class="line"><span style="color: #61AFEF">/dev/mst/mt41686_pciconf0</span><span style="color: #ABB2BF">        </span><span style="color: #98C379">-</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">PCI</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">configuration</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">cycles</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">access.</span></span>
<span class="line"><span style="color: #ABB2BF">                                   </span><span style="color: #61AFEF">domain:bus:dev.fn</span><span style="color: #ABB2BF">=0000:06:00.0 </span><span style="color: #98C379">addr.reg=</span><span style="color: #D19A66">88</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">data.reg=</span><span style="color: #D19A66">92</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">cr_bar.gw_offset=</span><span style="color: #D19A66">-1</span></span>
<span class="line"><span style="color: #ABB2BF">                                   </span><span style="color: #61AFEF">Chip</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">revision</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">is:</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">01</span></span></code></pre></div></div></figure>
<p>备份固件命令，这里请根据具体的PCI地址来修改。</p>
<figure class="shiki sh"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">flint</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">-d</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">06</span><span style="color: #98C379">:00.0</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">query</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">full</span><span style="color: #ABB2BF"> &gt; </span><span style="color: #98C379">flint_query.txt</span></span>
<span class="line"><span style="color: #61AFEF">flint</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">-d</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">06</span><span style="color: #98C379">:00.0</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">hw</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">query</span><span style="color: #ABB2BF"> &gt; </span><span style="color: #98C379">flint_hwinfo.txt</span></span>
<span class="line"><span style="color: #61AFEF">flint</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">-d</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">06</span><span style="color: #98C379">:00.0</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">ri</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">orig_firmware.mlx</span></span>
<span class="line"><span style="color: #61AFEF">flint</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">-d</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">06</span><span style="color: #98C379">:00.0</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">dc</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">orig_firmware.ini</span></span>
<span class="line"><span style="color: #61AFEF">flint</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">-d</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">06</span><span style="color: #98C379">:00.0</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">rrom</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">orig_rom.mlx</span></span>
<span class="line"><span style="color: #61AFEF">mlxburn</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">-d</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">06</span><span style="color: #98C379">:00.0</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">-vpd</span><span style="color: #ABB2BF"> &gt; </span><span style="color: #98C379">orig_vpd.txt</span></span></code></pre></div></div></figure>
<h2 id="9、启动-mst-服务，查询网卡版本">9、启动 mst 服务，查询网卡版本</h2>
<figure class="shiki sh"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">//</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">启动</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">mst</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">服务</span></span>
<span class="line"><span style="color: #61AFEF">sudo</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">mst</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">start</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">Starting</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">MST</span><span style="color: #ABB2BF"> (Mellanox </span><span style="color: #98C379">Software</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Tools</span><span style="color: #ABB2BF">) driver set</span></span>
<span class="line"><span style="color: #61AFEF">Loading</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">MST</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">PCI</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">module</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">-</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Success</span></span>
<span class="line"><span style="color: #ABB2BF">[warn] mst_pciconf is already loaded, skipping</span></span>
<span class="line"><span style="color: #61AFEF">Create</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">devices</span></span>
<span class="line"><span style="color: #61AFEF">Unloading</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">MST</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">PCI</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">module</span><span style="color: #ABB2BF"> (unused) - Success</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">//</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">查看</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">mst</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">状态</span></span>
<span class="line"><span style="color: #61AFEF">sudo</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">mst</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">status</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">MST</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">modules:</span></span>
<span class="line"><span style="color: #61AFEF">------------</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">MST</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">PCI</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">module</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">is</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">not</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">loaded</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">MST</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">PCI</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">configuration</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">module</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">loaded</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">MST</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">devices:</span></span>
<span class="line"><span style="color: #61AFEF">------------</span></span>
<span class="line"><span style="color: #61AFEF">/dev/mst/mt41686_pciconf0</span><span style="color: #ABB2BF">        </span><span style="color: #98C379">-</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">PCI</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">configuration</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">cycles</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">access.</span></span>
<span class="line"><span style="color: #ABB2BF">                                   </span><span style="color: #61AFEF">domain:bus:dev.fn</span><span style="color: #ABB2BF">=0000:03:00.0 </span><span style="color: #98C379">addr.reg=</span><span style="color: #D19A66">88</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">data.reg=</span><span style="color: #D19A66">92</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">cr_bar.gw_1</span></span>
<span class="line"><span style="color: #ABB2BF">                                   </span><span style="color: #61AFEF">Chip</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">revision</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">is:</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">01</span></span>
<span class="line"><span style="color: #61AFEF">//</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">查询网卡版本信息</span></span>
<span class="line"><span style="color: #61AFEF">sudo</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">mlxfwmanager</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">Querying</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Mellanox</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">devices</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">firmware</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">...</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">Device</span><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">#1:</span></span>
<span class="line"><span style="color: #61AFEF">----------</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">Device</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Type:</span><span style="color: #ABB2BF">      </span><span style="color: #98C379">BlueField2</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">Part</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Number:</span><span style="color: #ABB2BF">      </span><span style="color: #98C379">MBF2M345A-VENOT_ES_Ax</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">Description:</span><span style="color: #ABB2BF">      </span><span style="color: #98C379">NVIDIA</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">BlueField-2</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">E-Series</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Eng.</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">sample</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">DPU</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">200GbE</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">single-port</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">QSFP56</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">PCIe</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Gent</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">PSID:</span><span style="color: #ABB2BF">             </span><span style="color: #98C379">MT_0000000809</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">PCI</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Device</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Name:</span><span style="color: #ABB2BF">  </span><span style="color: #98C379">/dev/mst/mt41686_pciconf0</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">Base</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">GUID:</span><span style="color: #ABB2BF">        </span><span style="color: #98C379">b8cef60300f8d88a</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">Base</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">MAC:</span><span style="color: #ABB2BF">         </span><span style="color: #98C379">b8cef6f8d88a</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">Versions:</span><span style="color: #ABB2BF">         </span><span style="color: #98C379">Current</span><span style="color: #ABB2BF">        </span><span style="color: #98C379">Available</span><span style="color: #ABB2BF">     </span></span>
<span class="line"><span style="color: #ABB2BF">     </span><span style="color: #61AFEF">FW</span><span style="color: #ABB2BF">             </span><span style="color: #D19A66">24.31</span><span style="color: #98C379">.0356</span><span style="color: #ABB2BF">     </span><span style="color: #98C379">N/A</span><span style="color: #ABB2BF">           </span></span>
<span class="line"><span style="color: #ABB2BF">     </span><span style="color: #61AFEF">PXE</span><span style="color: #ABB2BF">            </span><span style="color: #D19A66">3.6</span><span style="color: #98C379">.0401</span><span style="color: #ABB2BF">       </span><span style="color: #98C379">N/A</span><span style="color: #ABB2BF">           </span></span>
<span class="line"><span style="color: #ABB2BF">     </span><span style="color: #61AFEF">UEFI</span><span style="color: #ABB2BF">           </span><span style="color: #D19A66">14.24</span><span style="color: #98C379">.0013</span><span style="color: #ABB2BF">     </span><span style="color: #98C379">N/A</span><span style="color: #ABB2BF">           </span></span>
<span class="line"><span style="color: #ABB2BF">     </span><span style="color: #61AFEF">UEFI</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Virtio</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">blk</span><span style="color: #ABB2BF">   </span><span style="color: #D19A66">22.1</span><span style="color: #98C379">.0011</span><span style="color: #ABB2BF">      </span><span style="color: #98C379">N/A</span><span style="color: #ABB2BF">           </span></span>
<span class="line"><span style="color: #ABB2BF">     </span><span style="color: #61AFEF">UEFI</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Virtio</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">net</span><span style="color: #ABB2BF">   </span><span style="color: #D19A66">21.1</span><span style="color: #98C379">.0011</span><span style="color: #ABB2BF">      </span><span style="color: #98C379">N/A</span><span style="color: #ABB2BF">           </span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">Status:</span><span style="color: #ABB2BF">           </span><span style="color: #98C379">No</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">matching</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">image</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">found</span></span></code></pre></div></div></figure>
<h2 id="10、更新网卡固件到-24-35-版本">10、更新网卡固件到 24.35 版本</h2>
<p>这个固件是包含在 DOCA 1.5.1 内的，据作者在评论区所说这是最后一个包含这个网卡 PSID 的最后一个版本系统。所以先刷 DOCA 1.5.1，再升级到 DOCA 2.7，再升级最新的网卡固件。能不能跳过这个步骤直接升级最新的网卡固件我不知道，我也不愿意试试，毕竟不便宜。</p>
<figure class="shiki sh"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">//</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">更新固件</span></span>
<span class="line"><span style="color: #61AFEF">sudo</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">/opt/mellanox/mlnx-fw-updater/firmware/mlxfwmanager_sriov_dis_aarch64_41686</span></span>
<span class="line"><span style="color: #61AFEF">Querying</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Mellanox</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">devices</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">firmware</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">...</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">Device</span><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">#1:</span></span>
<span class="line"><span style="color: #61AFEF">----------</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">Device</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Type:</span><span style="color: #ABB2BF">      </span><span style="color: #98C379">BlueField2</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">Part</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Number:</span><span style="color: #ABB2BF">      </span><span style="color: #98C379">MBF2M345A-VENOT_ES_Ax</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">Description:</span><span style="color: #ABB2BF">      </span><span style="color: #98C379">NVIDIA</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">BlueField-2</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">E-Series</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Eng.</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">sample</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">DPU</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">200GbE</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">single-port</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">QSFP56</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">PCIe</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Gen4</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">x16</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">Secure</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Boot</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Disabled</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">Crypto</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Enabled</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">16GB</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">on-board</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">DDR</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">1GbE</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">OOB</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">management</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">PSID:</span><span style="color: #ABB2BF">             </span><span style="color: #98C379">MT_0000000809</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">PCI</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Device</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Name:</span><span style="color: #ABB2BF">  </span><span style="color: #98C379">/dev/mst/mt41686_pciconf0</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">Base</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">GUID:</span><span style="color: #ABB2BF">        </span><span style="color: #98C379">b8cef60300f8d88a</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">Base</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">MAC:</span><span style="color: #ABB2BF">         </span><span style="color: #98C379">b8cef6f8d88a</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">Versions:</span><span style="color: #ABB2BF">         </span><span style="color: #98C379">Current</span><span style="color: #ABB2BF">        </span><span style="color: #98C379">Available</span></span>
<span class="line"><span style="color: #ABB2BF">     </span><span style="color: #61AFEF">FW</span><span style="color: #ABB2BF">             </span><span style="color: #D19A66">24.31</span><span style="color: #98C379">.0356</span><span style="color: #ABB2BF">     </span><span style="color: #D19A66">24.35</span><span style="color: #98C379">.2000</span></span>
<span class="line"><span style="color: #ABB2BF">     </span><span style="color: #61AFEF">NVMe</span><span style="color: #ABB2BF">           </span><span style="color: #98C379">N/A</span><span style="color: #ABB2BF">            </span><span style="color: #D19A66">20.4</span><span style="color: #98C379">.0001</span></span>
<span class="line"><span style="color: #ABB2BF">     </span><span style="color: #61AFEF">PXE</span><span style="color: #ABB2BF">            </span><span style="color: #D19A66">3.6</span><span style="color: #98C379">.0401</span><span style="color: #ABB2BF">       </span><span style="color: #D19A66">3.6</span><span style="color: #98C379">.0805</span></span>
<span class="line"><span style="color: #ABB2BF">     </span><span style="color: #61AFEF">UEFI</span><span style="color: #ABB2BF">           </span><span style="color: #D19A66">14.24</span><span style="color: #98C379">.0013</span><span style="color: #ABB2BF">     </span><span style="color: #D19A66">14.28</span><span style="color: #98C379">.0016</span></span>
<span class="line"><span style="color: #ABB2BF">     </span><span style="color: #61AFEF">UEFI</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Virtio</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">blk</span><span style="color: #ABB2BF">   </span><span style="color: #D19A66">22.1</span><span style="color: #98C379">.0011</span><span style="color: #ABB2BF">      </span><span style="color: #D19A66">22.4</span><span style="color: #98C379">.0010</span></span>
<span class="line"><span style="color: #ABB2BF">     </span><span style="color: #61AFEF">UEFI</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Virtio</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">net</span><span style="color: #ABB2BF">   </span><span style="color: #D19A66">21.1</span><span style="color: #98C379">.0011</span><span style="color: #ABB2BF">      </span><span style="color: #D19A66">21.4</span><span style="color: #98C379">.0010</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">Status:</span><span style="color: #ABB2BF">           </span><span style="color: #98C379">Update</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">required</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">---------</span></span>
<span class="line"><span style="color: #61AFEF">Found</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">device</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">s</span><span style="color: #ABB2BF">) </span><span style="color: #98C379">requiring</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">firmware</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">update...</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">Perform</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">FW</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">update?</span><span style="color: #ABB2BF"> [y/N]: y</span></span>
<span class="line"><span style="color: #61AFEF">Device</span><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">#1: Updating FW ...</span></span>
<span class="line"><span style="color: #61AFEF">FSMST_INITIALIZE</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">-</span><span style="color: #ABB2BF">   </span><span style="color: #98C379">OK</span></span>
<span class="line"><span style="color: #61AFEF">Writing</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Boot</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">image</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">component</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">-</span><span style="color: #ABB2BF">   </span><span style="color: #98C379">OK</span></span></code></pre></div></div></figure>
<h3 id="从系统内提取固件（不需要操作）">从系统内提取固件（不需要操作）</h3>
<p>下面是提取这个固件的命令，我已经提取好了，不用再操作了</p>
<figure class="shiki sh"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">scp</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">ubuntu@192.168.100.2:/opt/mellanox/mlnx-fw-updater/firmware/mlxfwmanager_sriov_dis_aarch64_41686</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">/</span></span></code></pre></div></div></figure>
<p>提取出来的固件解包通过 <a target="_blank" rel="noopener" href="https://github.com/BeTeP-STH/mft-scripts">mft-scripts</a> 可以看到是有这个 PSID 的</p>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">81. MT_0000000809  MBF2M345A-VENOT_ES_Ax            NVIDIA BlueField-2 E-Series Eng. sample DPU; 200GbE single-port QSFP56; PCIe Gen4 x16; Secure Boot Disa</span></span></code></pre></div></div></figure>
<p>然后从 mlnx-fw-updater_23.10-3.2.2.0_arm64.deb 中解包找到了最新的固件 24.39.3560</p>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">57. MT_0000000809  MBF2M345A-VENOT_ES_Ax            NVIDIA BlueField-2 E-Series Eng. sample DPU; 200GbE single-port QSFP56; PCIe Gen4 x16; Secure Boot Disa</span></span></code></pre></div></div></figure>
<h2 id="11、冷重启电脑，查看网卡版本">11、冷重启电脑，查看网卡版本</h2>
<p>查看到网卡版本已经更新到24.35.2000了</p>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">root@recopec-MS-7D25:/home/recopec# mlxfwmanager</span></span>
<span class="line"><span style="color: #abb2bf">Querying Mellanox devices firmware ...</span></span>
<span class="line"><span style="color: #abb2bf"></span></span>
<span class="line"><span style="color: #abb2bf">Device #1:</span></span>
<span class="line"><span style="color: #abb2bf">----------</span></span>
<span class="line"><span style="color: #abb2bf"></span></span>
<span class="line"><span style="color: #abb2bf">  Device Type:      BlueField2</span></span>
<span class="line"><span style="color: #abb2bf">  Part Number:      MBF2M345A-VENOT_ES_Ax</span></span>
<span class="line"><span style="color: #abb2bf">  Description:      NVIDIA BlueField-2 E-Series Eng. sample DPU; 200GbE single-port QSFP56; PCIe Gen4 x16; Secure Boot Disabled; Crypto Enabled; 16GB on-board DDR; 1GbE OOB management</span></span>
<span class="line"><span style="color: #abb2bf">  PSID:             MT_0000000809</span></span>
<span class="line"><span style="color: #abb2bf">  PCI Device Name:  0000:06:00.0</span></span>
<span class="line"><span style="color: #abb2bf">  Base GUID:        b8cef60300f8d88a</span></span>
<span class="line"><span style="color: #abb2bf">  Base MAC:         b8cef6f8d88a</span></span>
<span class="line"><span style="color: #abb2bf">  Versions:         Current        Available     </span></span>
<span class="line"><span style="color: #abb2bf">     FW             24.35.2000     N/A           </span></span>
<span class="line"><span style="color: #abb2bf">     PXE            3.6.0805       N/A           </span></span>
<span class="line"><span style="color: #abb2bf">     UEFI           14.28.0016     N/A           </span></span>
<span class="line"><span style="color: #abb2bf">     UEFI Virtio blk   22.4.0010      N/A           </span></span>
<span class="line"><span style="color: #abb2bf">     UEFI Virtio net   21.4.0010      N/A           </span></span>
<span class="line"><span style="color: #abb2bf"></span></span>
<span class="line"><span style="color: #abb2bf">  Status:           No matching image found</span></span></code></pre></div></div></figure>
<p>这个版本 UEFI BIOS 里面仍旧没有网卡模式选项，所以继续升级版本。</p>
<h2 id="12、DPU-更新-DOCA-2-7-版本">12、DPU 更新 DOCA 2.7 版本</h2>
<figure class="shiki sh"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">bfb-install</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">--rshim</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">rshim0</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">--bfb</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">bf-bundle-2.7.0-33_24.04_ubuntu-22.04_prod.bfb</span></span></code></pre></div></div></figure>
<p>更新过程中会提示更新 NIC FW 错误，不用管他</p>
<h2 id="13、启动成功后修改默认账户和密码">13、启动成功后修改默认账户和密码</h2>
<figure class="shiki"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #abb2bf">Mellanox BlueField-2 A1 BL1 V1.1                                                </span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  No CDI passed to Riot core!                                            </span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL2R: v2.2(release):4.7.0-25-g5569834                                  </span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL2R: Built : 22:05:22, Apr 26 2024                                    </span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL2R built for hw (ver 1)                                              </span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL2R: Booting BL2                                                      </span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL2: v2.2(release):4.7.0-25-g5569834                                   </span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL2: Built : 22:05:22, Apr 26 2024                                     </span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL2 built for hw (ver 1)                                               </span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  Running as MBF2M345A-VENOT_ system                                     </span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  No SPD detected on MSS0 DIMM0                                          </span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  No SPD detected on MSS0 DIMM1                                          </span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  Finished initializing DDR                                              </span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  DDR POST passed.                                                       </span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL31: v2.2(release):4.7.0-25-g5569834                                  </span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL31: Built : 22:05:22, Apr 26 2024                                    </span></span>
<span class="line"><span style="color: #abb2bf">NOTICE:  BL31 built for hw (ver 1), lifecycle GA Non-Secured                    </span></span>
<span class="line"><span style="color: #abb2bf">UEFI firmware (version BlueField:4.7.0-42-g13081ae-BId13127 built at 22:23:12 o)</span></span></code></pre></div></div></figure>
<p>ubuntu ubuntu</p>
<p>ubuntu Bf1122334455</p>
<h2 id="13、更新网卡版本">13、更新网卡版本</h2>
<figure class="shiki shell"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">sudo</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">mst</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">start</span></span>
<span class="line"><span style="color: #61AFEF">sudo</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">mst</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">status</span></span>
<span class="line"><span style="color: #61AFEF">sudo</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">mlxfwmanager</span><span style="color: #ABB2BF">                                            </span></span>
<span class="line"><span style="color: #61AFEF">Querying</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Mellanox</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">devices</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">firmware</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">...</span><span style="color: #ABB2BF">                                           </span></span>
<span class="line"><span style="color: #ABB2BF">                                                                                 </span></span>
<span class="line"><span style="color: #61AFEF">Device</span><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">#1:                                                                       </span></span>
<span class="line"><span style="color: #61AFEF">----------</span><span style="color: #ABB2BF">                                                                       </span></span>
<span class="line"><span style="color: #ABB2BF">                                                                                 </span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">Device</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Type:</span><span style="color: #ABB2BF">      </span><span style="color: #98C379">BlueField2</span><span style="color: #ABB2BF">                                                   </span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">Part</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Number:</span><span style="color: #ABB2BF">      </span><span style="color: #98C379">MBF2M345A-VENOT_ES_Ax</span><span style="color: #ABB2BF">                                        </span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">Description:</span><span style="color: #ABB2BF">      </span><span style="color: #98C379">NVIDIA</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">BlueField-2</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">E-Series</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Eng.</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">sample</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">DPU</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">200GbE</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">single-pt</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">PSID:</span><span style="color: #ABB2BF">             </span><span style="color: #98C379">MT_0000000809</span><span style="color: #ABB2BF">                                                </span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">PCI</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Device</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Name:</span><span style="color: #ABB2BF">  </span><span style="color: #98C379">/dev/mst/mt41686_pciconf0</span><span style="color: #ABB2BF">                                    </span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">Base</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">GUID:</span><span style="color: #ABB2BF">        </span><span style="color: #98C379">b8cef60300f8d88a</span><span style="color: #ABB2BF">                                             </span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">Base</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">MAC:</span><span style="color: #ABB2BF">         </span><span style="color: #98C379">b8cef6f8d88a</span><span style="color: #ABB2BF">                                                 </span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">Versions:</span><span style="color: #ABB2BF">         </span><span style="color: #98C379">Current</span><span style="color: #ABB2BF">        </span><span style="color: #98C379">Available</span><span style="color: #ABB2BF">                                     </span></span>
<span class="line"><span style="color: #ABB2BF">     </span><span style="color: #61AFEF">FW</span><span style="color: #ABB2BF">             </span><span style="color: #D19A66">24.35</span><span style="color: #98C379">.2000</span><span style="color: #ABB2BF">     </span><span style="color: #98C379">N/A</span><span style="color: #ABB2BF">                                           </span></span>
<span class="line"><span style="color: #ABB2BF">     </span><span style="color: #61AFEF">PXE</span><span style="color: #ABB2BF">            </span><span style="color: #D19A66">3.6</span><span style="color: #98C379">.0805</span><span style="color: #ABB2BF">       </span><span style="color: #98C379">N/A</span><span style="color: #ABB2BF">                                           </span></span>
<span class="line"><span style="color: #ABB2BF">     </span><span style="color: #61AFEF">UEFI</span><span style="color: #ABB2BF">           </span><span style="color: #D19A66">14.28</span><span style="color: #98C379">.0016</span><span style="color: #ABB2BF">     </span><span style="color: #98C379">N/A</span><span style="color: #ABB2BF">                                           </span></span>
<span class="line"><span style="color: #ABB2BF">     </span><span style="color: #61AFEF">UEFI</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Virtio</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">blk</span><span style="color: #ABB2BF">   </span><span style="color: #D19A66">22.4</span><span style="color: #98C379">.0010</span><span style="color: #ABB2BF">      </span><span style="color: #98C379">N/A</span><span style="color: #ABB2BF">                                        </span></span>
<span class="line"><span style="color: #ABB2BF">     </span><span style="color: #61AFEF">UEFI</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Virtio</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">net</span><span style="color: #ABB2BF">   </span><span style="color: #D19A66">21.4</span><span style="color: #98C379">.0010</span><span style="color: #ABB2BF">      </span><span style="color: #98C379">N/A</span><span style="color: #ABB2BF">                                        </span></span>
<span class="line"><span style="color: #ABB2BF">                                                                                 </span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">Status:</span><span style="color: #ABB2BF">           </span><span style="color: #98C379">No</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">matching</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">image</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">found</span></span></code></pre></div></div></figure>
<p>传送网卡固件到 DPU 内</p>
<figure class="shiki sh"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">scp</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">mlxfwmanager_sriov_dis_aarch64_41686</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">ubuntu@192.168.100.2:/home/ubuntu/</span></span></code></pre></div></div></figure>
<figure class="shiki sh"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">sudo</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">chmod</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">+x</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">mlxfwmanager_sriov_dis_aarch64_41686</span></span>
<span class="line"><span style="color: #61AFEF">sudo</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">./mlxfwmanager_sriov_dis_aarch64_41686</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">Querying</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Mellanox</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">devices</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">firmware</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">...</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">Device</span><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">#1:</span></span>
<span class="line"><span style="color: #61AFEF">----------</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">Device</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Type:</span><span style="color: #ABB2BF">      </span><span style="color: #98C379">BlueField2</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">Part</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Number:</span><span style="color: #ABB2BF">      </span><span style="color: #98C379">MBF2M345A-VENOT_ES_Ax</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">Description:</span><span style="color: #ABB2BF">      </span><span style="color: #98C379">NVIDIA</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">BlueField-2</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">E-Series</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Eng.</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">sample</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">DPU</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">200GbE</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">single-port</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">QSFP56</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">PCIe</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Gen4</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">x16</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">Secure</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Boot</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Disabled</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">Crypto</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Enabled</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">16GB</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">on-board</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">DDR</span><span style="color: #ABB2BF">; </span><span style="color: #61AFEF">1GbE</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">OOB</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">management</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">PSID:</span><span style="color: #ABB2BF">             </span><span style="color: #98C379">MT_0000000809</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">PCI</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Device</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Name:</span><span style="color: #ABB2BF">  </span><span style="color: #98C379">/dev/mst/mt41686_pciconf0</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">Base</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">GUID:</span><span style="color: #ABB2BF">        </span><span style="color: #98C379">b8cef60300f8d88a</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">Base</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">MAC:</span><span style="color: #ABB2BF">         </span><span style="color: #98C379">b8cef6f8d88a</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">Versions:</span><span style="color: #ABB2BF">         </span><span style="color: #98C379">Current</span><span style="color: #ABB2BF">        </span><span style="color: #98C379">Available</span></span>
<span class="line"><span style="color: #ABB2BF">     </span><span style="color: #61AFEF">FW</span><span style="color: #ABB2BF">             </span><span style="color: #D19A66">24.35</span><span style="color: #98C379">.2000</span><span style="color: #ABB2BF">     </span><span style="color: #D19A66">24.39</span><span style="color: #98C379">.3560</span></span>
<span class="line"><span style="color: #ABB2BF">     </span><span style="color: #61AFEF">NVMe</span><span style="color: #ABB2BF">           </span><span style="color: #98C379">N/A</span><span style="color: #ABB2BF">            </span><span style="color: #D19A66">20.4</span><span style="color: #98C379">.0001</span></span>
<span class="line"><span style="color: #ABB2BF">     </span><span style="color: #61AFEF">PXE</span><span style="color: #ABB2BF">            </span><span style="color: #D19A66">3.6</span><span style="color: #98C379">.0805</span><span style="color: #ABB2BF">       </span><span style="color: #D19A66">3.7</span><span style="color: #98C379">.0300</span></span>
<span class="line"><span style="color: #ABB2BF">     </span><span style="color: #61AFEF">UEFI</span><span style="color: #ABB2BF">           </span><span style="color: #D19A66">14.28</span><span style="color: #98C379">.0016</span><span style="color: #ABB2BF">     </span><span style="color: #D19A66">14.32</span><span style="color: #98C379">.0017</span></span>
<span class="line"><span style="color: #ABB2BF">     </span><span style="color: #61AFEF">UEFI</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Virtio</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">blk</span><span style="color: #ABB2BF">   </span><span style="color: #D19A66">22.4</span><span style="color: #98C379">.0010</span><span style="color: #ABB2BF">      </span><span style="color: #D19A66">22.4</span><span style="color: #98C379">.0012</span></span>
<span class="line"><span style="color: #ABB2BF">     </span><span style="color: #61AFEF">UEFI</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">Virtio</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">net</span><span style="color: #ABB2BF">   </span><span style="color: #D19A66">21.4</span><span style="color: #98C379">.0010</span><span style="color: #ABB2BF">      </span><span style="color: #D19A66">21.4</span><span style="color: #98C379">.0013</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">Status:</span><span style="color: #ABB2BF">           </span><span style="color: #98C379">Update</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">required</span></span></code></pre></div></div></figure>
<p>冷重启之后查看到更新完成</p>
<img src="/nvidia_boyfriend/image-20240715211452502.png" class="" title="image-20240715211452502">
<h2 id="14、切换为-NIC-模式">14、切换为 NIC 模式</h2>
<p><a target="_blank" rel="noopener" href="https://docs.nvidia.com/doca/sdk/nvidia+bluefield+modes+of+operation/index.html#src-2609505413_id-.NVIDIABlueFieldModesofOperationv2.7.0-NICModeforBlueField-2">https://docs.nvidia.com/doca/sdk/nvidia+bluefield+modes+of+operation/index.html#src-2609505413_id-.NVIDIABlueFieldModesofOperationv2.7.0-NICModeforBlueField-2</a></p>
<p>非常简单，官方提供了几种模式，其中最方便的是在 ARM 的 UEFI BIOS 里面修改。</p>
<ol>
<li>Select “Device Manager”.</li>
<li>Select “System Configuration”.</li>
<li>Select “BlueField Modes”.</li>
<li>Set the “NIC Mode” field to <code>NicMode</code> to enable NIC mode.</li>
</ol>
<img src="/nvidia_boyfriend/image-20240715210804919.png" class="" title="image-20240715210804919">
<img src="/nvidia_boyfriend/image-20240715210920040.png" class="" title="image-20240715210920040">
<img src="/nvidia_boyfriend/image-20240715211052801.png" class="" title="image-20240715211052801">
<p>上面的貌似不起作用，用下面这个试试。</p>
<figure class="shiki sh"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">//</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">启用</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">NIC</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">模式</span></span>
<span class="line"><span style="color: #61AFEF">mlxconfig</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">-d</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">mt41686_pciconf0</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">set</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">INTERNAL_CPU_PAGE_SUPPLIER=</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">INTERNAL_CPU_ESWITCH_MANAGER=</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">INTERNAL_CPU_IB_VPORT0=</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">INTERNAL_CPU_OFFLOAD_ENGINE=</span><span style="color: #D19A66">1</span></span></code></pre></div></div></figure>
<img src="/nvidia_boyfriend/image-20240715213306232.png" class="" title="image-20240715213306232">
<p>重启之后，网卡显示未插入网线，应该是正常了？我没有条件测试，就这样了，给物主发回去了。</p>
<p>所有的资源都在这里，网盘链接失效了的话就从我NAS里面慢慢拖吧，另外官网里面都有下载地址，随便找找就有了。</p>
<blockquote>
<p>链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1UV7XDu6N3P9oROhStSS8hw?pwd=2333">https://pan.baidu.com/s/1UV7XDu6N3P9oROhStSS8hw?pwd=2333</a><br>
提取码：2333</p>
<p><a target="_blank" rel="noopener" href="https://alist.irec.moe/@login">https://alist.irec.moe/@login</a></p>
<p>用户名：bf</p>
<p>密码：bf12345</p>
</blockquote>

    
  </article>

  
      
    <div class="nexmoe-post-copyright">
        <strong>本文作者：</strong>Recopec<br>
        <strong>本文链接：</strong><a href="https://blog.irec.moe/nvidia_boyfriend.html" title="https:&#x2F;&#x2F;blog.irec.moe&#x2F;nvidia_boyfriend.html" target="_blank" rel="noopener">https:&#x2F;&#x2F;blog.irec.moe&#x2F;nvidia_boyfriend.html</a><br>
        
            <strong>版权声明：</strong>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> 协议进行许可

        
    </div>


  
  
  <div class="nexmoe-post-meta nexmoe-rainbow">
   
    
        <a class="nexmoefont icon-tag-fill -none-link" href="/tags/%E7%BD%91%E5%8D%A1/" rel="tag">网卡</a>
    
</div>
  
  
    <script async src="/js/copy-codeblock.js?v=1751910940593"></script>
  

  
      <div class="nexmoe-post-footer">
          <script src="https://giscus.app/client.js"
      data-repo="Recopec/Recopec.github.io"
      data-repo-id="R_kgDOHWxLSA"
      data-category="Announcements"
      data-category-id="DIC_kwDOHWxLSM4CYhGk"
      data-mapping="title"
      data-strict="0"
      data-reactions-enabled="1"
      data-emit-metadata="0"
      data-input-position="top"
      data-theme="preferred_color_scheme"
      data-lang="zh-CN"
      data-loading="lazy"
      crossorigin="anonymous"
      async>
</script>

      </div>
  
</div></div><div class="nexmoe-post-right">    <div class="nexmoe-fixed">
        <div class="nexmoe-tool">

            

            
            
            <button class="mdui-fab catalog" style="overflow:unset;">
                <i class="nexmoefont icon-i-catalog"></i>
                <div class="nexmoe-toc">
                    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">前情提要</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">实物情况</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E5%9D%97"><span class="toc-number">2.1.</span> <span class="toc-text">第一块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%83%8C%E9%9D%A2%E6%A0%87%E7%AD%BE"><span class="toc-number">2.1.1.</span> <span class="toc-text">背面标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E4%BF%A1%E6%81%AF"><span class="toc-number">2.1.2.</span> <span class="toc-text">启动信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BA%E4%BB%B6%E7%89%88%E6%9C%AC"><span class="toc-number">2.1.3.</span> <span class="toc-text">固件版本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E5%9D%97"><span class="toc-number">2.2.</span> <span class="toc-text">第二块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E4%BF%A1%E6%81%AF-2"><span class="toc-number">2.2.1.</span> <span class="toc-text">启动信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BA%E4%BB%B6%E7%89%88%E6%9C%AC-2"><span class="toc-number">2.2.2.</span> <span class="toc-text">固件版本</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">资源</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E6%A1%A3"><span class="toc-number">3.1.</span> <span class="toc-text">文档</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DOCA-%E6%96%87%E6%A1%A3"><span class="toc-number">3.1.1.</span> <span class="toc-text">DOCA 文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-1-LTS-%E6%96%87%E6%A1%A3"><span class="toc-number">3.1.2.</span> <span class="toc-text">1.5.1 LTS 文档</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DOCA"><span class="toc-number">3.2.</span> <span class="toc-text">DOCA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E5%8D%A1%E5%9B%BA%E4%BB%B6"><span class="toc-number">3.3.</span> <span class="toc-text">网卡固件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text">具体步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%AE%89%E8%A3%85-Ubuntu"><span class="toc-number">4.1.</span> <span class="toc-text">1、安装 Ubuntu</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%AE%89%E8%A3%85-DOCA-%E7%8E%AF%E5%A2%83"><span class="toc-number">4.2.</span> <span class="toc-text">2、安装 DOCA 环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E5%90%AF%E5%8A%A8-rshim"><span class="toc-number">4.3.</span> <span class="toc-text">3、启动 rshim</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E4%BD%BF%E7%94%A8-minicom-%E8%BF%9E%E6%8E%A5-DPU"><span class="toc-number">4.4.</span> <span class="toc-text">4、使用 minicom 连接 DPU</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E9%87%8D%E7%BD%AE-DPU-%E7%9A%84-ARM-%E6%A0%B8"><span class="toc-number">4.5.</span> <span class="toc-text">5、重置 DPU 的 ARM 核</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81%E5%90%91-DPU-%E6%9B%B4%E6%96%B0-DOCA-1-5-1-LTS-%E7%89%88%E6%9C%AC"><span class="toc-number">4.6.</span> <span class="toc-text">6、向 DPU 更新 DOCA 1.5.1-LTS 版本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E3%80%81%E5%90%AF%E5%8A%A8%E6%88%90%E5%8A%9F%EF%BC%8C%E4%BF%AE%E6%94%B9%E9%BB%98%E8%AE%A4%E8%B4%A6%E6%88%B7%E5%92%8C%E5%AF%86%E7%A0%81"><span class="toc-number">4.7.</span> <span class="toc-text">7、启动成功，修改默认账户和密码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8%E3%80%81%E5%A4%87%E4%BB%BD%E7%BD%91%E5%8D%A1%E5%9B%BA%E4%BB%B6"><span class="toc-number">4.8.</span> <span class="toc-text">8、备份网卡固件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9%E3%80%81%E5%90%AF%E5%8A%A8-mst-%E6%9C%8D%E5%8A%A1%EF%BC%8C%E6%9F%A5%E8%AF%A2%E7%BD%91%E5%8D%A1%E7%89%88%E6%9C%AC"><span class="toc-number">4.9.</span> <span class="toc-text">9、启动 mst 服务，查询网卡版本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10%E3%80%81%E6%9B%B4%E6%96%B0%E7%BD%91%E5%8D%A1%E5%9B%BA%E4%BB%B6%E5%88%B0-24-35-%E7%89%88%E6%9C%AC"><span class="toc-number">4.10.</span> <span class="toc-text">10、更新网卡固件到 24.35 版本</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E7%B3%BB%E7%BB%9F%E5%86%85%E6%8F%90%E5%8F%96%E5%9B%BA%E4%BB%B6%EF%BC%88%E4%B8%8D%E9%9C%80%E8%A6%81%E6%93%8D%E4%BD%9C%EF%BC%89"><span class="toc-number">4.10.1.</span> <span class="toc-text">从系统内提取固件（不需要操作）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11%E3%80%81%E5%86%B7%E9%87%8D%E5%90%AF%E7%94%B5%E8%84%91%EF%BC%8C%E6%9F%A5%E7%9C%8B%E7%BD%91%E5%8D%A1%E7%89%88%E6%9C%AC"><span class="toc-number">4.11.</span> <span class="toc-text">11、冷重启电脑，查看网卡版本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12%E3%80%81DPU-%E6%9B%B4%E6%96%B0-DOCA-2-7-%E7%89%88%E6%9C%AC"><span class="toc-number">4.12.</span> <span class="toc-text">12、DPU 更新 DOCA 2.7 版本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13%E3%80%81%E5%90%AF%E5%8A%A8%E6%88%90%E5%8A%9F%E5%90%8E%E4%BF%AE%E6%94%B9%E9%BB%98%E8%AE%A4%E8%B4%A6%E6%88%B7%E5%92%8C%E5%AF%86%E7%A0%81"><span class="toc-number">4.13.</span> <span class="toc-text">13、启动成功后修改默认账户和密码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13%E3%80%81%E6%9B%B4%E6%96%B0%E7%BD%91%E5%8D%A1%E7%89%88%E6%9C%AC"><span class="toc-number">4.14.</span> <span class="toc-text">13、更新网卡版本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14%E3%80%81%E5%88%87%E6%8D%A2%E4%B8%BA-NIC-%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.15.</span> <span class="toc-text">14、切换为 NIC 模式</span></a></li></ol></li></ol>
                </div>
            </button>
            

            

            <a href="#nexmoe-content" class="backtop toc-link" aria-label="Back To Top" title="top"><button class="mdui-fab mdui-ripple"><i class="nexmoefont icon-caret-top"></i></button></a>
        </div>
    </div>
</div></div><div id="nexmoe-footer"><!--!--></div><div id="nexmoe-search-space"><div class="search-container"><div class="search-header"><div class="search-input-container"><input class="search-input" type="text" placeholder="搜索" onInput="sinput();"></div><a class="search-close" onclick="sclose();">×</a></div><div class="search-body"></div></div></div><div><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2058306854838448" crossorigin="anonymous"></script>
</div><!-- hexo injector body_end start -->
  <script>
  const CODE_CONFIG = {
    beautify: undefined,
    highlightCopy: undefined,
    highlightLang: undefined,
    highlightHeightLimit: undefined,
    isHighlightShrink: undefined,
    copy: {
      success: 'undefined',
      error: 'undefined',
      noSupport: 'undefined',
    }
  };
  console.log(
    `%c hexo-shiki-plugin %c v1.0.26 %c https://github.com/nova1751/hexo-shiki-plugin`,
    "color: #fff; background: #5f5f5f",
    "color: #fff; background: #80c8f8",
    ""
  );
  </script>
  <!-- hexo injector body_end end --></body></html>